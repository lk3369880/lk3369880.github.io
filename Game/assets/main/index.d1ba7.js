window.__require=function t(e,o,i){function n(l,s){if(!o[l]){if(!e[l]){var a=l.split("/");if(a=a[a.length-1],!e[a]){var c="function"==typeof __require&&__require;if(!s&&c)return c(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+l+"'")}l=a}var h=o[l]={exports:{}};e[l][0].call(h.exports,function(t){return n(e[l][1][t]||t)},h,h.exports,t,e,o,i)}return o[l].exports}for(var r="function"==typeof __require&&__require,l=0;l<i.length;l++)n(i[l]);return n}({Battle_Controller:[function(t,e){"use strict";function o(t,e){var o="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(o)return(o=o.call(t)).next.bind(o);if(Array.isArray(t)||(o=i(t))||e&&t&&"number"==typeof t.length){o&&(t=o);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function i(t,e){if(t){if("string"==typeof t)return n(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?n(t,e):void 0}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,i=new Array(e);o<e;o++)i[o]=t[o];return i}cc._RF.push(e,"685efW7y4xIj7YxB+5EdZoV","Battle_Controller");var r=t("Two_Select_One_Button"),l=t("Level_Up_Select_Button"),s=t("Skill_Cool_Icon");cc.Class({extends:cc.Component,properties:{Stage:2,Battle_Parent:cc.Node,Event_Parent:cc.Node,Shoot_Touch_State:cc.Node,Hero_Gun:cc.Node,Hero_Bullet:cc.Prefab,Hero_Bullet_Parent:cc.Node,Hero_Bullet_Bomb:cc.Prefab,Hero_Bullet_Bomb_Parent:cc.Node,trajectoryCtrl:{type:t("Trajectory_Controller"),default:null},Enemy:cc.Prefab,Enemy_Parent:cc.Node,Hit_Number:cc.Prefab,Particle_Parent:cc.Node,Now_Wave_Need_Create_Enemy_Num:5,Now_Wave_Created_Enemy_Num:0,Fire_Prefab:cc.Prefab,Fire_Damage_Prefab:cc.Prefab,Shoot_Bullet_Schedule:cc.Shedule,Create_Enemy_Schedule:cc.Schedule,Battle_End_Check_Schedule:cc.Schedule,Skill_Cool_Icon_Prefab:cc.Prefab,Skill_Cool_Icon_Parent:cc.Node,Skill_Cool_Icon_Script:[s],Skill_CSV:cc.TextAsset,Skill_Data:null,Bullet_Image:[cc.SpriteFrame],Level:1,Exp:0,Exp_Need:100,Hero_Hp:50,Hero_Hp_Max:100,Hero_Attack:350,Exp_Line:cc.Sprite,Level_Label:cc.Label,Hp_Line:cc.Sprite,Hp_Label:cc.Label,Attack_Label:cc.Label,Fire_Keep_Time:5,Critical_Rate:10,Critical_Multiply:50,Day:1,Event_CSV:cc.TextAsset,Event_Data:null,Event_Layout:cc.Node,Event_Prefab:cc.Prefab,Next_Day_Button:cc.Node,Two_Select_One_Button:[r],Level_Up_Select_Button:[l],Level_Up_Select_Parent:cc.Node,Obtained_Skills:{default:[],type:[cc.String]},Is_Have_Normal_Bullet_Split_Skill:!1,Is_Have_Skill_1_2:!1,Normal_Bullet_Shoot_Count:0,Event_Show_BG:[cc.SpriteFrame],Event_Show_Effect_BG:[cc.SpriteFrame]},onLoad:function(){cc.director.getPhysicsManager().enabled=!0,cc.director.getCollisionManager().enabled=!0,cc.director.getCollisionManager().enabledDebugDraw=!0,this._touchStartPos=null,this._lastAngle=0,this.initTouchEvents(),this.Two_Select_One_Button[0].Battle_Controller=this,this.Two_Select_One_Button[1].Battle_Controller=this,this.Level_Up_Select_Button[0].Battle_Controller=this,this.Level_Up_Select_Button[1].Battle_Controller=this,this.Level_Up_Select_Button[2].Battle_Controller=this,this.Load_Event_Data()},Load_Event_Data:function(){var t=this;cc.resources.load("CSV/Event",cc.TextAsset,function(e,o){e?console.error("\u52a0\u8f7d\u4e8b\u4ef6CSV\u5931\u8d25:",e):(t.Event_CSV=o,t.Parse_Event_Data())})},Parse_Event_Data:function(){if(this.Event_CSV){var t={0:"id",1:"title",2:"quality",3:"description",4:"paramA",5:"paramB"};console.log("\u5f00\u59cb\u89e3\u6790CSV\u6570\u636e");var e=this.Event_CSV.text.split("\n");console.log("CSV\u603b\u884c\u6570:",e.length),this.Event_Data={};for(var o=1;o<e.length;o++)if(e[o].trim()){for(var i=e[o].split(",").map(function(t){return t.trim()}),n=i[0],r={},l=0;l<i.length;l++){var s=i[l]||"",a=t[l];a&&("description"===a?s=s.replace(/\u3010\u9017\u53f7\u3011/g,","):"paramA"!==a&&"paramB"!==a||(s=parseInt(s)||0),r[a]=s)}this.Event_Data[n]=r}console.log("\u89e3\u6790\u5b8c\u6210\uff0c\u4e8b\u4ef6\u6570\u636e:",this.Event_Data),console.log("\u4e8b\u4ef6\u6570\u636e\u793a\u4f8b (ID=1):",this.Event_Data[1]),this.Load_Skill_Data()}else console.error("Event_CSV is null")},Get_Event_Data:function(t,e){return this.Event_Data&&this.Event_Data[t]?this.Event_Data[t][e]:null},Load_Skill_Data:function(){var t=this;cc.resources.load("CSV/Skill",cc.TextAsset,function(e,o){e?console.error("\u52a0\u8f7d\u6280\u80fdCSV\u5931\u8d25:",e):(t.Skill_CSV=o,t.Parse_Skill_Data())})},Parse_Skill_Data:function(){if(this.Skill_CSV){var t={0:"weaponId",1:"skillId",2:"title",3:"quality",4:"description",5:"prerequisiteId",6:"oneTimeOnly"};console.log("\u5f00\u59cb\u89e3\u6790\u6280\u80fdCSV\u6570\u636e");var e=this.Skill_CSV.text.split("\n");console.log("CSV\u603b\u884c\u6570:",e.length),this.Skill_Data={};for(var o=1;o<e.length;o++)if(e[o].trim()){for(var i=e[o].split(",").map(function(t){return t.trim()}),n=i[0],r=i[1],l={},s=0;s<i.length;s++){var a=i[s]||"",c=t[s];c&&("description"===c?a=a.replace(/\u3010\u9017\u53f7\u3011/g,","):["weaponId","skillId","quality","prerequisiteId","oneTimeOnly"].includes(c)&&(a=parseInt(a)||0),l[c]=a)}var h=n+"_"+r;this.Skill_Data[h]=l}console.log("\u89e3\u6790\u5b8c\u6210\uff0c\u6280\u80fd\u6570\u636e:",this.Skill_Data),console.log("\u6280\u80fd\u6570\u636e\u793a\u4f8b (\u6b66\u5668ID=0,\u6280\u80fdID=1):",this.Skill_Data["0_1"]),this.Start_Set()}else console.error("Skill_CSV is null")},Get_Skill_Data:function(t,e){var o=t+"_"+e;return this.Skill_Data[o]||null},Start_Set:function(){this.Set_Schedule(),this.Create_Skill(0),this.Next_Day_Button.on(cc.Node.EventType.TOUCH_END,this.Next_Day,this)},initTouchEvents:function(){this.Shoot_Touch_State.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.Shoot_Touch_State.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.Shoot_Touch_State.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.Shoot_Touch_State.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this)},onTouchStart:function(t){this._touchStartPos=t.getLocation(),this._lastAngle=this.Hero_Gun.angle,this.updateTrajectory()},onTouchMove:function(t){if(this._touchStartPos){var e=.2*(t.getLocation().y-this._touchStartPos.y),o=Math.max(-60,Math.min(60,this._lastAngle+e));this.Hero_Gun.angle=o,this.updateTrajectory()}},onTouchEnd:function(){this._touchStartPos=null,this.trajectoryCtrl&&this.trajectoryCtrl.clearTrajectory()},updateTrajectory:function(){if(this.trajectoryCtrl){var t=this.Hero_Gun.angle,e=this.Hero_Gun.x+70*Math.cos(t*Math.PI/180),o=this.Hero_Gun.y+70*Math.sin(t*Math.PI/180);this.trajectoryCtrl.updateTrajectory(e,o,t,1e3,5)}},shootBullet:function(t,e,o,i,n){var r=cc.instantiate(this.Hero_Bullet);r.parent=this.Hero_Bullet_Parent;var l=(this.Hero_Gun.angle+o)*Math.PI/180,s=70*Math.cos(l),a=70*Math.sin(l);r.x=this.Hero_Gun.x+20+s,r.y=this.Hero_Gun.y+a;var c=r.getComponent("Hero_Bullet");c&&(c.Attack=Math.ceil(this.Hero_Attack*i/100),c.Battle_Controller=this,c.Skill_Script=n,c.Start_set(l,1e3,e,t)),c.Image.spriteFrame=this.Bullet_Image[t],this.Is_Have_Skill_1_2&&(console.log("\u89e3\u9501\u4e86\u6280\u80fd1_2"),0==t&&(console.log("\u53d1\u5c04\u666e\u901a\u70ae\u5f39"),this.Normal_Bullet_Shoot_Count++,console.log("\u666e\u901a\u70ae\u5f39\u53d1\u5c04\u6b21\u6570"+this.Normal_Bullet_Shoot_Count),this.Normal_Bullet_Shoot_Count>=1&&(console.log("\u53d1\u5c04\u706b\u7130\u5f39"),this.Is_Have_Skill_1_2&&(console.log("\u53d1\u5c04\u706b\u7130\u5f39!!!!!!!!"),this.scheduleOnce(function(){console.log("~~~~~~~~~~~~~~~~");var t=this.Skill_Cool_Icon_Script.find(function(t){return 1===t.ID});console.log(t),this.shootBullet(1,t.Bomb_Scale,0,t.Attack_Percent,t)},.2)),this.Normal_Bullet_Shoot_Count=0)))},createEnemy:function(){if(this.Now_Wave_Created_Enemy_Num>=this.Now_Wave_Need_Create_Enemy_Num)this.unschedule(this.Create_Enemy_Schedule);else{var t=cc.instantiate(this.Enemy);t.parent=this.Enemy_Parent,t.setPosition(1002.597,323.689);var e=t.getComponent("Enemy");e&&(e.Battle_Controller=this),this.Now_Wave_Created_Enemy_Num++}},Set_Schedule:function(){this.Shoot_Bullet_Schedule=function(){for(var t=this.Skill_Cool_Icon_Script,e=0,o=t.length;e<o;e++)t[e].Cool_Energy()},this.Create_Enemy_Schedule=function(){this.createEnemy()},this.Battle_End_Check_Schedule=function(){0==this.Enemy_Parent.childrenCount&&this.Now_Wave_Created_Enemy_Num>=this.Now_Wave_Need_Create_Enemy_Num&&this.Enter_Event()}},Next_Day:function(){if(2==this.Stage){var t=cc.instantiate(this.Event_Prefab);t.parent=this.Event_Layout;var e=this.Event_Layout.children.length;if(e>2){var o=400+400*(e-2);cc.Tween.stopAllByTarget(this.Event_Layout);var i=Math.abs(o-this.Event_Layout.y)/1e3;cc.tween(this.Event_Layout).to(i,{y:o}).start()}var n=t.getComponent("Event");n.Battle_Controller=this;var r=!1,l=null;switch(this.Day){case 5:case 10:r=!0,n.Event_Text.string="\u654c\u4eba\u6765\u88ad\uff0c\u51c6\u5907\u6218\u6597\uff01",n.Background.spriteFrame=this.Event_Show_BG[1],n.Effect_Background.node.active=!1,n.Effect_Text.node.active=!1,this.Enter_Battle();break;case 1:case 3:case 6:l=this.Get_Event("8");break;default:l=this.Random_Event()}if(!r&&l&&(n.Event_Text.string=l.description,n.Background.spriteFrame=this.Event_Show_BG[l.quality],l.id)){var s="Event_Effect_"+l.id;"function"==typeof n[s]?n[s](l.paramA,l.paramB):console.warn("\u4e8b\u4ef6\u6548\u679c\u65b9\u6cd5 "+s+" \u4e0d\u5b58\u5728")}n.Day_Text.string="\u7b2c"+this.Day+"\u5929",this.Day++}},Random_Event:function(){var t;console.log("Event_Data:",this.Event_Data);var e=100*Math.random();t=e<50?"1":e<80?"2":"3",console.log("\u968f\u673a\u5230\u7684\u54c1\u8d28:",t);var o=[];if(Object.entries(this.Event_Data).forEach(function(e){var i=e[0],n=e[1];console.log("\u68c0\u67e5\u4e8b\u4ef6:",i,n),console.log("\u4e8b\u4ef6\u54c1\u8d28:",n.quality,"\u76ee\u6807\u54c1\u8d28:",t),n.quality===t&&o.push(i)}),console.log("\u627e\u5230\u7684\u7b26\u5408\u54c1\u8d28\u7684\u4e8b\u4ef6:",o),o.length>0){var i=Math.floor(Math.random()*o.length),n=o[i];return this.Event_Data[n]}return console.error("\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u4e8b\u4ef6"),null},Get_Event:function(t){if(console.log("Event_Data:",this.Event_Data),!this.Event_Data||!this.Event_Data[t])return console.error("\u672a\u627e\u5230ID\u4e3a"+t+"\u7684\u4e8b\u4ef6\u6570\u636e"),null;var e=this.Event_Data[t];return console.log("\u83b7\u53d6\u5230\u7684\u4e8b\u4ef6:",e),e},No_Event_Create_Event_Show:function(t,e,o,i){var n=cc.instantiate(this.Event_Prefab);n.parent=this.Event_Layout;var r=n.getComponent("Event");r.Battle_Controller=this,r.Day_Text.string="\u7b2c"+this.Day+"\u5929",r.Event_Text.string=e,r.Background.spriteFrame=this.Event_Show_BG[t],0==o&&(r.Effect_Background.node.active=!1),r.Effect_Text.string=i;var l=this.Event_Layout.children.length;if(l>2){var s=400+400*(l-2);cc.Tween.stopAllByTarget(this.Event_Layout);var a=Math.abs(s-this.Event_Layout.y)/1e3;cc.tween(this.Event_Layout).to(a,{y:s}).start()}},Battle_Win_Event:function(){var t=cc.instantiate(this.Event_Prefab);t.parent=this.Event_Layout;var e=t.getComponent("Event");e.Battle_Controller=this,e.Day_Text.string="\u7b2c"+this.Day+"\u5929",e.Event_Text.string="\u6218\u6597\u80dc\u5229\uff01\u4f60\u53d8\u5f3a\u4e86",e.Background.spriteFrame=this.Event_Show_BG[3],e.Effect_Text.string="\u7ecf\u9a8c\u503c+100%",this.Add_Exp(100);var o=this.Event_Layout.children.length;if(o>2){var i=400+400*(o-2);cc.Tween.stopAllByTarget(this.Event_Layout);var n=Math.abs(i-this.Event_Layout.y)/1e3;cc.tween(this.Event_Layout).to(n,{y:i}).start()}},Add_Attack:function(t){this.Hero_Attack+=t,this.Attack_Label.string=this.Hero_Attack},Add_Hp_Max:function(t){var e=this.Hero_Hp/this.Hero_Hp_Max;this.Hero_Hp_Max+=t,this.Hero_Hp=Math.ceil(this.Hero_Hp_Max*e),this.Hp_Label.string=this.Hero_Hp+"/"+this.Hero_Hp_Max},Add_Exp:function(t){this.Exp+=t,this.Exp>=this.Exp_Need&&(this.Exp-=this.Exp_Need,this.Level+=1,this.Level_Up(),this.Level_Label.string="LV."+this.Level),cc.Tween.stopAllByTarget(this.Exp_Line),cc.tween(this.Exp_Line).to(.1,{fillRange:this.Exp/this.Exp_Need}).start()},Add_Hp:function(t){var e=Math.ceil(this.Hero_Hp_Max*t/100);this.Hero_Hp=Math.min(this.Hero_Hp+e,this.Hero_Hp_Max),cc.Tween.stopAllByTarget(this.Hp_Line),cc.tween(this.Hp_Line).to(.5,{fillRange:this.Hero_Hp/this.Hero_Hp_Max}).start(),this.Hp_Label.string=this.Hero_Hp+"/"+this.Hero_Hp_Max},Enter_Event:function(){var t=this;this.unschedule(this.Shoot_Bullet_Schedule),this.unschedule(this.Create_Enemy_Schedule),this.unschedule(this.Battle_End_Check_Schedule),cc.tween(this.Battle_Parent).to(.5,{x:0},{easing:"sineIn"}).start(),cc.tween(this.Event_Parent).to(.5,{x:0},{easing:"sineIn"}).call(function(){t.Battle_Win_Event(),t.Stage=2}).start(),cc.tween(this.Skill_Cool_Icon_Parent.parent).to(.5,{x:-1200},{easing:"sineIn"}).start()},Enter_Battle:function(){var t=this;this.Stage=1,this.Now_Wave_Created_Enemy_Num=0,this.Normal_Bullet_Shoot_Count=0;for(var e=this.Skill_Cool_Icon_Script,o=0,i=e.length;o<i;o++)e[o].Now_Cool_Energy=0,e[o].Cool_Sprite.fillRange=1;cc.tween(this.Battle_Parent).to(.5,{x:-539.044},{easing:"sineIn"}).call(function(){cc.tween(t.Event_Parent).to(.5,{x:1317.289},{easing:"sineIn"}).call(function(){t.schedule(t.Shoot_Bullet_Schedule,.02),t.schedule(t.Create_Enemy_Schedule,2),t.schedule(t.Battle_End_Check_Schedule,2)}).start()}).start(),cc.tween(this.Skill_Cool_Icon_Parent.parent).to(.5,{x:0},{easing:"sineIn"}).start()},Level_Up:function(){this.Level_Up_Select_Parent.active=!0;for(var t=this.Random_Skill_Select(),e=0;e<3;e++){var o=this.Level_Up_Select_Button[e],i=t[e];o&&i&&(o.Weapon_ID=i.weaponId,o.Skill_ID=i.skillId,o.Description=i.description,o.Title_Label.string=i.title,o.Description_Label.string=i.description,console.log("\u8bbe\u7f6e\u6309\u94ae"+(e+1)+":","\u6b66\u5668ID="+i.weaponId,"\u6280\u80fdID="+i.skillId,"\u6807\u9898="+i.title,"\u63cf\u8ff0="+i.description))}},Create_Skill:function(t){var e=cc.instantiate(this.Skill_Cool_Icon_Prefab);e.parent=this.Skill_Cool_Icon_Parent;var o=e.getComponent("Skill_Cool_Icon");switch(o.ID=t,o.Battle_Controller=this,t){case 0:o.Cool_Need_Energy=150,o.Attack_Percent=100;break;case 1:o.Cool_Need_Energy=250,o.Attack_Percent=20}this.Skill_Cool_Icon_Script.push(o)},Random_Skill_Select:function(){for(var t,e=this,i=[],n=new Set,r=new Set,l=o(this.Skill_Cool_Icon_Script);!(t=l()).done;){var s=t.value;r.add(s.ID)}console.log("\u5f53\u524d\u5df2\u62e5\u6709\u7684\u6b66\u5668ID:",Array.from(r));var a={};Object.keys(this.Skill_Data).forEach(function(t){var e=t.split("_").map(Number),o=e[0],i=e[1];(!a[o]||i>a[o])&&(a[o]=i)}),console.log("\u6bcf\u4e2a\u6b66\u5668\u7684\u6700\u5927\u6280\u80fdID:",a);for(var c=function(t,o){var i=t+"_"+o,n=e.Skill_Data[i];if(!n)return console.log("\u6280\u80fd "+i+" \u4e0d\u5b58\u5728"),!1;if(n.oneTimeOnly&&e.Obtained_Skills.includes(i))return console.log("\u6280\u80fd "+i+" \u662f\u4e00\u6b21\u6027\u6280\u80fd\u4e14\u5df2\u83b7\u5f97"),!1;if(0!==n.prerequisiteId){var r=t+"_"+n.prerequisiteId;if(!e.Obtained_Skills.includes(r))return console.log("\u6280\u80fd "+i+" \u9700\u8981\u524d\u7f6e\u6280\u80fd "+r),!1}return!0};i.length<3;){var h=Object.keys(a).map(Number),_=h[Math.floor(Math.random()*h.length)];console.log("\u968f\u673a\u9009\u62e9\u6b66\u5668ID:",_);var u=void 0;if(r.has(_)){var p=0;do{u=Math.floor(Math.random()*a[_])+1,p++,console.log("\u5c1d\u8bd5\u7b2c "+p+" \u6b21\u4e3a\u6b66\u5668 "+_+" \u9009\u62e9\u6280\u80fd "+u)}while(!c(_,u)&&p<10);if(p>=10){console.log("\u672a\u80fd\u4e3a\u6b66\u5668 "+_+" \u627e\u5230\u53ef\u7528\u6280\u80fd\uff0c\u91cd\u65b0\u5f00\u59cb");continue}}else u=0,console.log("\u6b66\u5668 "+_+" \u662f\u65b0\u6b66\u5668\uff0c\u9009\u62e9\u57fa\u7840\u6280\u80fd 0");var f=_+"_"+u;if(n.has(f))console.log("\u7ec4\u5408 "+f+" \u5df2\u88ab\u9009\u62e9\uff0c\u91cd\u65b0\u5f00\u59cb");else{var d=this.Skill_Data[f];d&&c(_,u)&&(i.push({weaponId:_,skillId:u,title:d.title,quality:d.quality,description:d.description}),n.add(f),console.log("\u6210\u529f\u6dfb\u52a0\u6280\u80fd\u7ec4\u5408 "+f))}}return console.log("\u6700\u7ec8\u9009\u62e9\u7684\u4e09\u4e2a\u6280\u80fd:",i),i}}),cc._RF.pop()},{Level_Up_Select_Button:"Level_Up_Select_Button",Skill_Cool_Icon:"Skill_Cool_Icon",Trajectory_Controller:"Trajectory_Controller",Two_Select_One_Button:"Two_Select_One_Button"}],Bullet_Mult:[function(t,e){"use strict";cc._RF.push(e,"40237WZ+YNMdqFyDQkV7AiU","Bullet_Mult"),cc.Class({extends:cc.Component,properties:{Number:3},start:function(){}}),cc._RF.pop()},{}],Enemy:[function(t,e){"use strict";cc._RF.push(e,"2b1b3dDKzxDcLtRKtTnnlIG","Enemy"),cc.Class({extends:cc.Component,properties:{Battle_Controller:null,Speed:100,Hp_Max:100,Hp:100,Hp_Line:cc.Node,Animation:cc.Animation,Enemy_Dead_Particle:cc.Prefab},start:function(){},update:function(t){this.node.x-=this.Speed*t},Injured:function(t,e){var o=this.Battle_Controller.Critical_Rate+((null==e?void 0:e.Critical_Rate_Bonus)||0),i=this.Battle_Controller.Critical_Multiply+((null==e?void 0:e.Critical_Multiply_Bonus)||0),n=100*Math.random()<o;n&&(t=Math.ceil(t*(1+i/100)));var r=cc.instantiate(this.Battle_Controller.Hit_Number);r.parent=this.Battle_Controller.Particle_Parent,r.x=this.node.x,r.y=this.node.y+100;var l=r.getComponent(cc.Label);if(l.string=t,n&&(r.scale=2,l.node.color=cc.Color.RED),this.Animation.playAdditive("Enemy_Injured"),this.Hp-=t,this.Hp_Line.scaleX=this.Hp/this.Hp_Max,this.Hp<=0){var s=cc.instantiate(this.Enemy_Dead_Particle);s.parent=this.Battle_Controller.Particle_Parent,s.x=this.node.x,s.y=this.node.y,this.node.destroy()}}}),cc._RF.pop()},{}],Event:[function(t,e){"use strict";cc._RF.push(e,"d9cdc8muRNFEY7oNPw8Ggeb","Event"),cc.Class({extends:cc.Component,properties:{Battle_Controller:null,Day_Text:cc.Label,Event_Text:cc.RichText,Effect_Text:cc.Label,Background:cc.Sprite,Effect_Background:cc.Sprite},start:function(){},Event_Effect_1:function(t){this.Effect_Text.string="\u653b\u51fb\u529b+"+t+"%";var e=Math.ceil(this.Battle_Controller.Hero_Attack*(t/100));this.Battle_Controller.Add_Attack(e),this.Effect_Background.spriteFrame=this.Battle_Controller.Event_Show_Effect_BG[0]},Event_Effect_2:function(t){this.Effect_Text.string="\u653b\u51fb\u529b+"+t+"%";var e=Math.ceil(this.Battle_Controller.Hero_Attack*(t/100));this.Battle_Controller.Add_Attack(e),this.Effect_Background.spriteFrame=this.Battle_Controller.Event_Show_Effect_BG[0]},Event_Effect_3:function(t){this.Effect_Text.string="\u653b\u51fb\u529b+"+t+"%";var e=Math.ceil(this.Battle_Controller.Hero_Attack*(t/100));this.Battle_Controller.Add_Attack(e),this.Effect_Background.spriteFrame=this.Battle_Controller.Event_Show_Effect_BG[0]},Event_Effect_4:function(t){this.Effect_Text.string="\u8840\u91cf\u4e0a\u9650+"+t+"%";var e=Math.ceil(this.Battle_Controller.Hero_Hp_Max*(t/100));this.Battle_Controller.Add_Hp_Max(e),this.Effect_Background.spriteFrame=this.Battle_Controller.Event_Show_Effect_BG[1]},Event_Effect_5:function(t){this.Effect_Text.string="\u8840\u91cf\u4e0a\u9650+"+t+"%";var e=Math.ceil(this.Battle_Controller.Hero_Hp_Max*(t/100));this.Battle_Controller.Add_Hp_Max(e),this.Effect_Background.spriteFrame=this.Battle_Controller.Event_Show_Effect_BG[1]},Event_Effect_6:function(t){this.Effect_Text.string="\u8840\u91cf\u4e0a\u9650+"+t+"%";var e=Math.ceil(this.Battle_Controller.Hero_Hp_Max*(t/100));this.Battle_Controller.Add_Hp_Max(e),this.Effect_Background.spriteFrame=this.Battle_Controller.Event_Show_Effect_BG[1]},Event_Effect_7:function(t){this.Effect_Text.string="\u7ecf\u9a8c\u503c+"+t+"%",this.Battle_Controller.Add_Exp(t),this.Effect_Background.spriteFrame=this.Battle_Controller.Event_Show_Effect_BG[0]},Event_Effect_8:function(t){this.Effect_Text.string="\u7ecf\u9a8c\u503c+"+t+"%",this.Battle_Controller.Add_Exp(t),this.Effect_Background.spriteFrame=this.Battle_Controller.Event_Show_Effect_BG[0]},Event_Effect_9:function(t,e){console.log(t),console.log(e),this.Effect_Background.node.active=!1,this.Battle_Controller.Next_Day_Button.active=!1,this.Battle_Controller.Two_Select_One_Button[0].node.active=!0,this.Battle_Controller.Two_Select_One_Button[1].node.active=!0,this.Battle_Controller.Two_Select_One_Button[0].Event_ID=9,this.Battle_Controller.Two_Select_One_Button[0].Content_Label.string="\u4f11\u606f",this.Battle_Controller.Two_Select_One_Button[0].Element_Label.string="\u751f\u547d\u503c\u6062\u590d"+t+"%",this.Battle_Controller.Two_Select_One_Button[0].ParamA=t,this.Battle_Controller.Two_Select_One_Button[1].Event_ID=9,this.Battle_Controller.Two_Select_One_Button[1].Content_Label.string="\u8bad\u7ec3",this.Battle_Controller.Two_Select_One_Button[1].Element_Label.string="\u653b\u51fb\u529b\u589e\u52a0"+e+"%",this.Battle_Controller.Two_Select_One_Button[1].ParamA=e}}),cc._RF.pop()},{}],Example1:[function(t,e,o){"use strict";cc._RF.push(e,"4975aGNb/RF5qr3YkdDHi3o","Example1");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,l=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(l=(r<3?n(l):r>3?n(e,o,l):n(e,o))||l);return r>3&&l&&Object.defineProperty(e,o,l),l},l=this&&this.__awaiter||function(t,e,o,i){return new(o||(o=Promise))(function(n,r){function l(t){try{a(i.next(t))}catch(e){r(e)}}function s(t){try{a(i.throw(t))}catch(e){r(e)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o(function(t){t(e)})).then(l,s)}a((i=i.apply(t,e||[])).next())})},s=this&&this.__generator||function(t,e){var o,i,n,r,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(t){return function(e){return a([t,e])}}function a(r){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return l.label++,{value:r[1],done:!1};case 5:l.label++,i=r[1],r=[0];continue;case 7:r=l.ops.pop(),l.trys.pop();continue;default:if(!(n=(n=l.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){l=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){l.label=r[1];break}if(6===r[0]&&l.label<n[1]){l.label=n[1],n=r;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(r);break}n[2]&&l.ops.pop(),l.trys.pop();continue}r=e.call(t,l)}catch(s){r=[6,s],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var a=t("./TextMeshPro"),c=t("./utils/TmpUtils"),h=cc._decorator,_=h.ccclass,u=h.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.text1=null,e.text2=null,e.text3=null,e._time=0,e._fScale=1,e._xOffset=0,e._initPos=[],e.alpha=0,e}return n(e,t),e.prototype.start=function(){var t=this;this.anim1(),this.anim3(),this.scheduleOnce(function(){for(var e=0;e<t.text2.string.length;e++){var o=t.text2.getPosVertices(e);t._initPos.push(o)}},0)},e.prototype.update=function(t){this._time+=t,this.anim2()},e.prototype.anim1=function(){return l(this,void 0,Promise,function(){var t,e,o,i=this;return s(this,function(n){switch(n.label){case 0:return[4,c.default.waitCmpt(this,1)];case 1:for(n.sent(),this.text1.string="\u8fd9 \u662f \u4e00 \u6bb5 \u6d4b \u8bd5 \u6587 \u5b57aaagghjsa;dzxmc;",this.text1.forceUpdateRenderData(),this.text2.tmpUniform.outlineColor=cc.color(123,223,0),o=0;o<this.text1.string.length;o++)this.text1.setVisible(o,!1);t=function(t){var o,n,r;return s(this,function(l){switch(l.label){case 0:return e.text1.setVisible(t,!0),e.text1.isVisible(t)?(o=e.text1.getPosVertices(t),(n=cc.v2()).x=(o[0].x+o[1].x+o[2].x+o[3].x)/4,n.y=(o[0].y+o[1].y+o[2].y+o[3].y)/4,e._xOffset=-30,r=function(){var e=[];e.push(o[0].clone()),e.push(o[1].clone()),e.push(o[2].clone()),e.push(o[3].clone());for(var r=0;r<4;r++){var l=e[r].sub(n);l.mulSelf(i._fScale).addSelf(cc.v2(i._xOffset,0)),e[r]=n.add(l)}i.text1.setPosVertices(t,e)},cc.tween(e).to(.05,{_fScale:2,_xOffset:-15},{onUpdate:r}).to(.05,{_fScale:1,_xOffset:0},{onUpdate:r}).start(),[4,c.default.waitCmpt(e,.1)]):[2,"continue"];case 1:return l.sent(),[2]}})},e=this,o=0,n.label=2;case 2:return o<this.text1.string.length?[5,t(o)]:[3,5];case 3:n.sent(),n.label=4;case 4:return o++,[3,2];case 5:return[2]}})})},e.prototype.anim2=function(){if(!(this._initPos.length<=0))for(var t=0;t<this.text2.string.length;t++)if(this.text2.isVisible(t)){for(var e=[],o=0;o<4;o++)e.push(this._initPos[t][o].clone()),e[o].y+=10*Math.sin(.5*t+5*this._time);this.text2.setPosVertices(t,e)}},e.prototype.anim3=function(){return l(this,void 0,Promise,function(){var t,e,o,i=this;return s(this,function(n){switch(n.label){case 0:return[4,c.default.waitCmpt(this,1)];case 1:for(n.sent(),this.text3.string="\u8fd9 \u662f \u4e00 \u6bb5 \u6d4b \u8bd5 \u6587 \u5b57aaagghjsa;dzxmc;",this.text3.forceUpdateRenderData(),o=0;o<this.text3.string.length;o++)this.text3.setVisible(o,!1);t=function(t){var o;return s(this,function(n){switch(n.label){case 0:return e.text3.setVisible(t,!0),e.text3.isVisible(t)?(e.text3.setVisible(t,!1),o=e.text3.getColorExtraVertices(t),e.alpha=0,cc.tween(e).to(.05,{alpha:255},{onUpdate:function(){o[0].a=i.alpha,o[2].a=i.alpha,i.text3.setColorExtraVertices(t,o)}}).call(function(){i.alpha=0}).to(.05,{alpha:255},{onUpdate:function(){o[1].a=i.alpha,o[3].a=i.alpha,i.text3.setColorExtraVertices(t,o)}}).start(),[4,c.default.waitCmpt(e,.1)]):[2,"continue"];case 1:return n.sent(),[2]}})},e=this,o=0,n.label=2;case 2:return o<this.text3.string.length?[5,t(o)]:[3,5];case 3:n.sent(),n.label=4;case 4:return o++,[3,2];case 5:return[2]}})})},r([u(a.default)],e.prototype,"text1",void 0),r([u(a.default)],e.prototype,"text2",void 0),r([u(a.default)],e.prototype,"text3",void 0),r([_],e)}(cc.Component);o.default=p,cc._RF.pop()},{"./TextMeshPro":"TextMeshPro","./utils/TmpUtils":"TmpUtils"}],Hero_Bullet_Bomb:[function(t,e){"use strict";cc._RF.push(e,"415e9Dlo7ZJHZFERRUHxADb","Hero_Bullet_Bomb"),cc.Class({extends:cc.Component,properties:{Battle_Controller:null,Attack:10,Type:0,Fire_Keep_Time:0,Fire_Schedule:cc.Schedule,Fire_Keep_Time_Now:0,Skill_Script:null},Start_Set:function(){1==this.Type&&(this.Fire_Schedule=function(){this.Fire_Keep_Time_Now+=1;var t=cc.instantiate(this.Battle_Controller.Fire_Damage_Prefab);t.parent=this.node.parent,t.position=this.node.position,t.scale=this.node.scale;var e=t.getComponent("Hero_Bullet_Bomb");e&&(e.Battle_Controller=this.Battle_Controller,e.Attack=this.Attack),this.Fire_Keep_Time_Now>=this.Fire_Keep_Time&&this.Destroy_Self()})},Start_Fire_Schedule:function(){this.Fire_Keep_Time=this.Battle_Controller.Fire_Keep_Time,this.schedule(this.Fire_Schedule,1)},onCollisionEnter:function(t){if("Enemy"===t.node.group){var e=t.node.getComponent("Enemy");e&&e.Injured(this.Attack,this.Skill_Script)}},Destroy_Self:function(){this.node.destroy()}}),cc._RF.pop()},{}],Hero_Bullet:[function(t,e){"use strict";cc._RF.push(e,"5ac1e8JgU9Bc5YqjsNISdvA","Hero_Bullet");var o=t("Motion_Streak_Script");cc.Class({extends:cc.Component,properties:{Battle_Controller:null,bulletPrefab:{default:null,type:cc.Prefab,tooltip:"\u5b50\u5f39\u9884\u5236\u4f53"},ignoreMultId:-1,RigidBody:cc.RigidBody,Attack:10,Motion_Streak_Script:o,Bomb_Scale:1,Weapon_ID:0,Image:cc.Sprite,Skill_Script:null,Is_Normal_Bullet_Split_Bullet:!1},onBeginContact:function(t,e,o){if(o.node.getComponent("Bullet_Mult")&&!1===this.Is_Normal_Bullet_Split_Bullet){var i=o.node.getComponent("Bullet_Mult");if(this.ignoreMultId===o.node.uuid)return;var n=this.RigidBody.linearVelocity,r=Math.sqrt(n.x*n.x+n.y*n.y),l=180*Math.atan2(n.y,n.x)/Math.PI;this.generateNewBullets(i.Number,r,l,o.node.uuid)}else if("Ground"===o.node.group){if(1===this.Weapon_ID){var s=cc.instantiate(this.Battle_Controller.Fire_Prefab);s.parent=this.node.parent,s.x=this.node.x,s.y=291.05,s.scale=this.Bomb_Scale,(c=s.getComponent("Hero_Bullet_Bomb"))&&(c.Battle_Controller=this.Battle_Controller,c.Skill_Script=this.Skill_Script,c.Attack=this.Attack,c.Type=1,c.Start_Set(),c.Start_Fire_Schedule())}else{var a=cc.instantiate(this.Battle_Controller.Hero_Bullet_Bomb);a.parent=this.node.parent,a.position=this.node.position,a.scale=this.Bomb_Scale,(c=a.getComponent("Hero_Bullet_Bomb"))&&(c.Battle_Controller=this.Battle_Controller,c.Skill_Script=this.Skill_Script,c.Attack=this.Attack)}this.Motion_Streak_Script.node.parent=this.Battle_Controller.Particle_Parent,this.Motion_Streak_Script.node.x=this.node.x,this.Motion_Streak_Script.node.y=this.node.y,this.Motion_Streak_Script.Wait_Destroy(),this.Destroy_Self()}else{if(console.log("\u78b0\u5230\u654c\u4eba"),console.log(this.Weapon_ID),1==this.Weapon_ID)return;console.log("\u78b0\u5230\u654c\u4eba"),console.log(this.Weapon_ID);var c,h=cc.instantiate(this.Battle_Controller.Hero_Bullet_Bomb);h.parent=this.node.parent,h.position=this.node.position,h.scale=this.Bomb_Scale,(c=h.getComponent("Hero_Bullet_Bomb"))&&(c.Battle_Controller=this.Battle_Controller,c.Skill_Script=this.Skill_Script,c.Attack=this.Attack),this.Motion_Streak_Script.node.parent=this.Battle_Controller.Particle_Parent,this.Motion_Streak_Script.node.x=this.node.x,this.Motion_Streak_Script.node.y=this.node.y,this.Motion_Streak_Script.Wait_Destroy(),this.Destroy_Self()}},generateNewBullets:function(t,e,o,i){for(var n=0;n<t;n++){var r=cc.instantiate(this.bulletPrefab);r.parent=this.node.parent,r.position=this.node.position;var l=r.getComponent("Hero_Bullet");if(l){l.ignoreMultId=i;var s=e+60*Math.random()+20,a=(o+(120*Math.random()-60))*Math.PI/180;l.Attack=this.Attack,l.Battle_Controller=this.Battle_Controller,l.Skill_Script=this.Skill_Script,l.Start_set(a,s,this.Bomb_Scale,this.Weapon_ID),l.Image.spriteFrame=this.Battle_Controller.Bullet_Image[this.Weapon_ID]}}},Start_set:function(t,e,o,i){this.RigidBody&&(this.RigidBody.enabledContactListener=!0,this.RigidBody.linearVelocity=cc.v2(Math.cos(t)*e,Math.sin(t)*e)),this.Weapon_ID=i,this.Bomb_Scale=o},Destroy_Self:function(){0==this.Weapon_ID&&this.Battle_Controller.Is_Have_Normal_Bullet_Split_Skill&&0==this.Is_Normal_Bullet_Split_Bullet&&this.Normal_Bullet_Split_Skill_Create_Small_Bullet(),this.node.destroy()},Normal_Bullet_Split_Skill_Create_Small_Bullet:function(){for(var t=[100,80],e=0;e<2;e++){var o=cc.instantiate(this.bulletPrefab);o.parent=this.node.parent,o.position=this.node.position,o.scale=.5;var i=o.getComponent("Hero_Bullet");if(i){var n=t[e]*Math.PI/180;i.Attack=Math.ceil(.2*this.Attack),i.Battle_Controller=this.Battle_Controller,i.Skill_Script=this.Skill_Script,i.Start_set(n,800,Math.ceil(.2*this.Bomb_Scale),this.Weapon_ID),i.Image.spriteFrame=this.Battle_Controller.Bullet_Image[this.Weapon_ID],i.Is_Normal_Bullet_Split_Bullet=!0}}}}),cc._RF.pop()},{Motion_Streak_Script:"Motion_Streak_Script"}],Hti_Number:[function(t,e){"use strict";cc._RF.push(e,"9998a/jq71LNJfF2niF5zxH","Hti_Number"),cc.Class({extends:cc.Component,properties:{},start:function(){var t=this;cc.tween(this.node).by(1,{opacity:-255,y:200},{easing:"quadIn"}).call(function(){t.node.destroy()}).start()}}),cc._RF.pop()},{}],HtmlParser:[function(t,e,o){"use strict";cc._RF.push(e,"02dfeRXpgdHcJRaYhbNPx6G","HtmlParser"),Object.defineProperty(o,"__esModule",{value:!0}),o.HtmlTextParser=void 0;var i=/^(click)(\s)*=|(param)(\s)*=/,n=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,r=function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"]),this._specialSymbolArray.push([/&nbsp;/g," "])}return t.prototype.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,o=t.length;e<o;){var i=t.indexOf(">",e),n=-1;if(i>=0&&(n=t.lastIndexOf("<",i))<e-1&&(n=t.indexOf("<",i+1),i=t.indexOf(">",n+1)),n<0)this._stack.pop(),this._processResult(t.substring(e)),e=o;else{var r=t.substring(e,n),l=t.substring(n+1,i);""===l&&(r=t.substring(e,i+1)),this._processResult(r),-1===i?i=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(l),e=i+1}}return this._resultObjectArray},t.prototype._attributeToObject=function(t){t=t.trim();var e={},o=/^(color|size)(\s)*=/.exec(t),i="",r=0,l="";if(o){if(i=o[0],""===(t=t.substring(i.length).trim()))return e;switch(r=t.indexOf(" "),i[0]){case"c":e.color=r>-1?t.substring(0,r).trim():t;break;case"s":e.size=parseInt(t)}return r>-1&&(l=t.substring(r+1).trim(),e.event=this._processEventHandler(l)),e}if((o=/^(br(\s)*\/)/.exec(t))&&o[0].length>0&&(i=o[0].trim()).startsWith("br")&&"/"===i[i.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var s="",a=-1;if((o=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&o[0].length>0&&(i=o[0].trim()).startsWith("img")&&"/"===i[i.length-1]){o=n.exec(t);for(var c=void 0,h=!1;o;){var _=(i=(t=t.substring(t.indexOf(o[0]))).substr(0,o[0].length)).length;if(i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),s=t.substring(_).trim(),a="src"===i?this.getRightQuotationIndex(s):-1,c=(r=s.indexOf(" ",a+1>=s.length?-1:a+1))>-1?s.substr(0,r):s,t=s.substring(r).trim(),c.endsWith("/")&&(c=c.slice(0,-1)),"src"===i){switch(c.charCodeAt(0)){case 34:case 39:h=!0,c=c.slice(1,-1)}e.isImage=!0,e.src=c}else if("height"===i)e.imageHeight=parseInt(c);else if("width"===i)e.imageWidth=parseInt(c);else if("align"===i){switch(c.charCodeAt(0)){case 34:case 39:c=c.slice(1,-1)}e.imageAlign=c.toLowerCase()}else"offset"===i?e.imageOffset=c:"click"===i&&(e.event=this._processEventHandler(i+"="+c));e.event&&"param"===i&&(e.event[i]=c.replace(/^"|"$/g,"")),o=n.exec(t)}return h&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(o=/^(cg(\s)*[^>]*)/.exec(t)){var u={lb:"#ffffff",rb:"#ffffff",lt:"#ffffff",rt:"#ffffff"};if(t=o[0].substring("cg".length).trim()){var p,f=/(\s)*lb(\s)*=|(\s)*rb(\s)*=|(\s)*lt(\s)*=|(\s)*rt(\s)*=/;for(o=f.exec(t),c=void 0;o;)i=(t=t.substring(t.indexOf(o[0]))).substr(0,o[0].length),c=(r=(p=t.substring(i.length).trim()).indexOf(" "))>-1?p.substr(0,r):p,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=p.substring(r).trim(),"lb"===i?u.lb=c:"rb"===i?u.rb=c:"lt"===i?u.lt=c:"rt"===i&&(u.rt=c),o=f.exec(t)}e.colorGradient=u}if(o=/^(face(\s)*[^>]*)/.exec(t)){var d={color:"#ffffff",dilate:.5,softness:.01};if(t=o[0].substring("face".length).trim()){var g,y=/(\s)*color(\s)*=|(\s)*dilate(\s)*=|(\s)*softness(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(o=y.exec(t),c=void 0;o;)i=(t=t.substring(t.indexOf(o[0]))).substr(0,o[0].length),c=(r=(g=t.substring(i.length).trim()).indexOf(" "))>-1?g.substr(0,r):g,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=g.substring(r).trim(),"click"===i?e.event=this._processEventHandler(i+"="+c):"color"===i?d.color=c:"dilate"===i?d.dilate=Number(c):"softness"===i&&(d.softness=Number(c)),e.event&&"param"===i&&(e.event.param=c.replace(/^\"|\"$/g,"")),o=y.exec(t)}e.face=d}if(o=/^(outline(\s)*[^>]*)/.exec(t)){var m={color:"#ffffff",thickness:.1};if(t=o[0].substring("outline".length).trim()){var v=/(\s)*color(\s)*=|(\s)*thickness(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(o=v.exec(t),c=void 0;o;)i=(t=t.substring(t.indexOf(o[0]))).substr(0,o[0].length),c=(r=(s=t.substring(i.length).trim()).indexOf(" "))>-1?s.substr(0,r):s,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=s.substring(r).trim(),"click"===i?e.event=this._processEventHandler(i+"="+c):"color"===i?m.color=c:"thickness"===i&&(m.thickness=Number(c)),e.event&&"param"===i&&(e.event[i]=c.replace(/^"|"$/g,"")),o=v.exec(t)}e.outline=m}if(o=/^(underlay(\s)*[^>]*)/.exec(t)){var b={color:"#ffffff",x:0,y:0,dilate:.5,softness:.1};if(t=o[0].substring("underlay".length).trim()){var C,S=/(\s)*color(\s)*=|(\s)*x(\s)*=|(\s)*y(\s)*=|(\s)*dilate(\s)*=|(\s)*softness(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(o=S.exec(t),c=void 0;o;)i=(t=t.substring(t.indexOf(o[0]))).substr(0,o[0].length),c=(r=(C=t.substring(i.length).trim()).indexOf(" "))>-1?C.substr(0,r):C,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=C.substring(r).trim(),"click"===i?e.event=this._processEventHandler(i+"="+c):"color"===i?b.color=c:"dilate"===i?b.dilate=Number(c):"softness"===i?b.softness=Number(c):"x"===i?b.x=Number(c):"y"===i&&(b.y=Number(c)),e.event&&"param"===i&&(e.event.param=c.replace(/^\"|\"$/g,"")),o=S.exec(t)}e.underlay=b}if(o=/^(glow(\s)*[^>]*)/.exec(t)){var x={color:"#000000",offset:.5,inner:.01,outer:.01,power:1};if(t=o[0].substring("glow".length).trim()){var E,T=/(\s)*color(\s)*=|(\s)*offset(\s)*=|(\s)*inner(\s)*=|(\s)*outer(\s)*=|(\s)*power(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(o=T.exec(t),c=void 0;o;)i=(t=t.substring(t.indexOf(o[0]))).substr(0,o[0].length),c=(r=(E=t.substring(i.length).trim()).indexOf(" "))>-1?E.substr(0,r):E,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=E.substring(r).trim(),"click"===i?e.event=this._processEventHandler(i+"="+c):"color"===i?x.color=c:"offset"===i?x.offset=Number(c):"inner"===i?x.inner=Number(c):"outer"===i?x.outer=Number(c):"power"===i&&(x.power=Number(c)),e.event&&"param"===i&&(e.event.param=c.replace(/^\"|\"$/g,"")),o=T.exec(t)}e.glow=x}if((o=/^(on|u|s|b|i)(\s)*/.exec(t))&&o[0].length>0){switch(i=o[0],t=t.substring(i.length).trim(),i[0]){case"u":e.underline=!0,e.offset="="===t[0]?Number(t.slice(1)):0;break;case"s":e.strikethrough=!0,e.offset="="===t[0]?Number(t.slice(1)):0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},t.prototype.getRightQuotationIndex=function(t){var e=-1,o=-1,i=t.indexOf("'"),n=t.indexOf('"'),r=n>-1&&(n<i||-1===i);return i>-1&&(i<n||-1===n)?(e=i,o=t.indexOf("'",e+1>=t.length?-1:e+1)):r&&(e=n,o=t.indexOf('"',e+1>=t.length?-1:e+1)),o},t.prototype._processEventHandler=function(t){for(var e={},o=0,n=!1,r=i.exec(t);r;){var l=r[0],s="";if(n=!1,'"'===(t=t.substring(l.length).trim()).charAt(0))(o=t.indexOf('"',1))>-1&&(s=t.substring(1,o).trim(),n=!0),o++;else if("'"===t.charAt(0))(o=t.indexOf("'",1))>-1&&(s=t.substring(1,o).trim(),n=!0),o++;else{var a=/(\S)+/.exec(t);o=(s=a?a[0]:"").length}n&&(e[l=l.substring(0,l.length-1).trim()]=s),t=t.substring(o).trim(),r=i.exec(t)}return e},t.prototype._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var o=this._stack[this._stack.length-1];for(var i in o)e[i]||(e[i]=o[i]);this._stack.push(e)}},t.prototype._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},t.prototype._escapeSpecialSymbol=function(t){for(var e=0,o=this._specialSymbolArray;e<o.length;e++){var i=o[e],n=i[0],r=i[1];t=t.replace(n,r)}return t},t}();o.HtmlTextParser=r,cc._RF.pop()},{}],Level_Up_Select_Button:[function(t,e){"use strict";cc._RF.push(e,"1271185AftPWYUbcvnermhr","Level_Up_Select_Button"),cc.Class({extends:cc.Component,properties:{Battle_Controller:null,Weapon_ID:0,Skill_ID:0,Description:"",Title_Label:cc.Label,Description_Label:cc.Label},start:function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onButtonClick,this)},onButtonClick:function(){this.Battle_Controller.Level_Up_Select_Parent.active=!1;var t=this.Weapon_ID+"_"+this.Skill_ID;this.Battle_Controller.Obtained_Skills.includes(t)||this.Battle_Controller.Obtained_Skills.push(t);var e="Skill_"+this.Weapon_ID+"_"+this.Skill_ID;"function"==typeof this[e]?this[e]():console.error("\u65b9\u6cd5 "+e+" \u4e0d\u5b58\u5728")},Skill_0_1:function(){var t=this.Battle_Controller.Skill_Cool_Icon_Script.find(function(t){return 0===t.ID});t?(t.One_Shoot_Bullet_Number+=1,t.Attack_Percent>10&&(t.Attack_Percent-=5),this.Battle_Controller.No_Event_Create_Event_Show(1,"\u3010\u666e\u901a\u70ae\u5f39\u4e2a\u6570+1\uff0c\u4f24\u5bb3\u2193",!1,0),console.log("\u6280\u80fd 0_1 \u88ab\u89e6\u53d1\uff0cID \u4e3a 0 \u7684\u6280\u80fd\u56fe\u6807\u7684\u5b50\u5f39\u6570\u91cf\u589e\u52a0\u5230: "+t.One_Shoot_Bullet_Number)):console.error("\u672a\u627e\u5230 ID \u4e3a 0 \u7684\u6280\u80fd\u56fe\u6807\u811a\u672c")},Skill_0_2:function(){var t=this.Battle_Controller.Skill_Cool_Icon_Script.find(function(t){return 0===t.ID});t?(t.Critical_Rate_Bonus+=5,this.Battle_Controller.No_Event_Create_Event_Show(1,"\u666e\u901a\u70ae\u5f39\u66b4\u51fb\u7387\u2191\u2191",!1,0)):console.error("\u672a\u627e\u5230 ID \u4e3a 0 \u7684\u6280\u80fd\u56fe\u6807\u811a\u672c")},Skill_0_3:function(){var t=this.Battle_Controller.Skill_Cool_Icon_Script.find(function(t){return 0===t.ID});t?(t.Critical_Multiply_Bonus+=20,this.Battle_Controller.No_Event_Create_Event_Show(1,"\u666e\u901a\u70ae\u5f39\u66b4\u51fb\u4f24\u5bb3\u2191",!1,0)):console.error("\u672a\u627e\u5230 ID \u4e3a 0 \u7684\u6280\u80fd\u56fe\u6807\u811a\u672c")},Skill_0_4:function(){var t=this.Battle_Controller.Skill_Cool_Icon_Script.find(function(t){return 0===t.ID});t?(t.Cool_Need_Energy-=20,t.Cool_Need_Energy<10&&(t.Cool_Need_Energy=10),this.Battle_Controller.No_Event_Create_Event_Show(1,"\u666e\u901a\u70ae\u5f39\u51b7\u5374\u65f6\u95f4\u2193",!1,0)):console.error("\u672a\u627e\u5230 ID \u4e3a 0 \u7684\u6280\u80fd\u56fe\u6807\u811a\u672c")},Skill_0_5:function(){this.Battle_Controller.Is_Have_Normal_Bullet_Split_Skill=!0,this.Battle_Controller.No_Event_Create_Event_Show(1,"\u666e\u901a\u70ae\u5f39\u7206\u70b8\u540e\uff0c\u88c2\u53d8\u6210\u4e24\u4e2a\u5c0f\u70ae\u5f39",!1,0)},Skill_1_0:function(){this.Battle_Controller.Create_Skill(1),this.Battle_Controller.No_Event_Create_Event_Show(1,"\u4f60\u5b66\u4f1a\u4e86\u3010\u706b\u7130\u5f39\u3011\uff01",!1,0)},Skill_1_1:function(){var t=this.Battle_Controller.Skill_Cool_Icon_Script.find(function(t){return 1===t.ID});t?(t.Attack_Percent+=10,this.Battle_Controller.No_Event_Create_Event_Show(1,"\u71c3\u70e7\u533a\u57df\u9020\u6210\u4f24\u5bb3\u2191",!1,0)):console.error("\u672a\u627e\u5230 ID \u4e3a 1 \u7684\u6280\u80fd\u56fe\u6807\u811a\u672c")},Skill_1_2:function(){this.Battle_Controller.Is_Have_Skill_1_2=!0,this.Battle_Controller.No_Event_Create_Event_Show(1,"\u6bcf\u53d1\u5c045\u9897\u666e\u901a\u70ae\u5f39\uff0c\u989d\u5916\u53d1\u5c04\u4e00\u9897\u706b\u7130\u5f39",!1,0)},Skill_1_3:function(){var t=this.Battle_Controller.Skill_Cool_Icon_Script.find(function(t){return 1===t.ID});t.Cool_Need_Energy-=20,t.Cool_Need_Energy<10&&(t.Cool_Need_Energy=10),this.Battle_Controller.No_Event_Create_Event_Show(1,"\u706b\u7130\u70ae\u5f39\u7684\u51b7\u5374\u65f6\u95f4\u2193",!1,0)},Skill_1_4:function(){this.Battle_Controller.Skill_Cool_Icon_Script.find(function(t){return 1===t.ID}).Bomb_Scale+=.5,this.Battle_Controller.No_Event_Create_Event_Show(1,"\u71c3\u70e7\u533a\u57df\u8303\u56f4\u2191",!1,0)},Skill_1_5:function(){this.Battle_Controller.Fire_Keep_Time+=2,this.Battle_Controller.No_Event_Create_Event_Show(1,"\u71c3\u70e7\u533a\u57df\u6301\u7eed\u65f6\u95f4\u2191",!1,0)}}),cc._RF.pop()},{}],Motion_Streak_Script:[function(t,e){"use strict";cc._RF.push(e,"104c3wxz0FL5oH/uZ3cLZJv","Motion_Streak_Script"),cc.Class({extends:cc.Component,properties:{Destroy_Time:1.2},Wait_Destroy:function(){this.schedule(function(){this.node.destroy()},this.Destroy_Time)}}),cc._RF.pop()},{}],Skill_Cool_Icon:[function(t,e){"use strict";cc._RF.push(e,"69f83jsJgVPIroMRBPkUBRz","Skill_Cool_Icon"),cc.Class({extends:cc.Component,properties:{Battle_Controller:cc.Node,Cool_Need_Energy:0,Now_Cool_Energy:0,Icon_Sprite:cc.Sprite,Cool_Sprite:cc.Sprite,ID:0,Bomb_Scale:1,One_Shoot_Bullet_Number:1,Attack_Percent:100,Critical_Rate_Bonus:0,Critical_Multiply_Bonus:0},Cool_Energy:function(){this.Now_Cool_Energy+=1,this.Now_Cool_Energy>=this.Cool_Need_Energy&&(this.Shoot(),this.Now_Cool_Energy=0),this.Cool_Sprite.fillRange=1-this.Now_Cool_Energy/this.Cool_Need_Energy},Shoot:function(){for(var t=0;t<this.One_Shoot_Bullet_Number;t++){var e=5*(t+1)*(t%2==0?1:-1);this.Battle_Controller.shootBullet(this.ID,this.Bomb_Scale,e,this.Attack_Percent,this)}}}),cc._RF.pop()},{}],TextMeshPro:[function(t,e,o){"use strict";cc._RF.push(e,"b26c9Lk3GNMmoip2mcq6Nyf","TextMeshPro");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,l=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(l=(r<3?n(l):r>3?n(e,o,l):n(e,o))||l);return r>3&&l&&Object.defineProperty(e,o,l),l};Object.defineProperty(o,"__esModule",{value:!0}),o.TmpUniform=o.TmpOverflow=void 0;var l,s=t("./utils/TmpAssembler"),a=t("./utils/TmpFontConfig"),c=(t("./utils/TmpUtils"),cc._decorator),h=c.ccclass,_=c.property,u=c.executeInEditMode,p=c.menu;(function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.ELLIPSIS=2]="ELLIPSIS",t[t.SHRINK=3]="SHRINK",t[t.RESIZE_HEIGHT=4]="RESIZE_HEIGHT"})(l=o.TmpOverflow||(o.TmpOverflow={}));var f=function(){function t(){this._faceColor=cc.Color.WHITE,this._faceDilate=.5,this._faceSoftness=.01,this._enableOutline=!1,this._outlineColor=cc.color(255,0,0,255),this._outlineThickness=.1,this._enableUnderlay=!1,this._underlayColor=cc.color(0,0,0,255),this._underlayOffset=cc.v2(0,0),this._underlayDilate=.5,this._underlaySoftness=.1,this._enableGlow=!1,this._glowColor=cc.color(0,255,0,255),this._glowOffset=.5,this._glowInner=.01,this._glowOuter=.01,this._glowPower=1,this._comp=null}return Object.defineProperty(t.prototype,"faceColor",{get:function(){return this._faceColor},set:function(t){this._faceColor!==t&&(this._faceColor=t,this._comp&&this._comp.updateTmpMatFace(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"faceDilate",{get:function(){return this._faceDilate},set:function(t){this._faceDilate!==t&&(this._faceDilate=t,this._comp&&this._comp.updateTmpMatFace(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"faceSoftness",{get:function(){return this._faceSoftness},set:function(t){this._faceSoftness!==t&&(this._faceSoftness=t,this._comp&&this._comp.updateTmpMatFace(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableOutline",{get:function(){return this._enableOutline},set:function(t){this._enableOutline!==t&&(this._enableOutline=t,this._comp&&this._comp.updateTmpMatOutline(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outlineColor",{get:function(){return this._outlineColor},set:function(t){this._outlineColor!==t&&(this._outlineColor=t,this._comp&&this._comp.updateTmpMatOutline(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"outlineThickness",{get:function(){return this._outlineThickness},set:function(t){this._outlineThickness!==t&&(this._outlineThickness=t,this._comp&&this._comp.updateTmpMatOutline(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableUnderlay",{get:function(){return this._enableUnderlay},set:function(t){this._enableUnderlay!==t&&(this._enableUnderlay=t,this._comp&&this._comp.updateTmpMatUnderlay(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"underlayColor",{get:function(){return this._underlayColor},set:function(t){this._underlayColor!==t&&(this._underlayColor=t,this._comp&&this._comp.updateTmpMatUnderlay(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"underlayOffset",{get:function(){return this._underlayOffset},set:function(t){this._underlayOffset!==t&&(this._underlayOffset=t,this._comp&&this._comp.updateTmpMatUnderlay(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"underlayDilate",{get:function(){return this._underlayDilate},set:function(t){this._underlayDilate!==t&&(this._underlayDilate=t,this._comp&&this._comp.updateTmpMatUnderlay(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"underlaySoftness",{get:function(){return this._underlaySoftness},set:function(t){this._underlaySoftness!==t&&(this._underlaySoftness=t,this._comp&&this._comp.updateTmpMatUnderlay(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enableGlow",{get:function(){return this._enableGlow},set:function(t){this._enableGlow!==t&&(this._enableGlow=t,this._comp&&this._comp.updateTmpMatGlow(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowColor",{get:function(){return this._glowColor},set:function(t){this._glowColor!==t&&(this._glowColor=t,this._comp&&this._comp.updateTmpMatGlow(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowOffset",{get:function(){return this._glowOffset},set:function(t){this._glowOffset!==t&&(this._glowOffset=t,this._comp&&this._comp.updateTmpMatGlow(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowInner",{get:function(){return this._glowInner},set:function(t){this._glowInner!==t&&(this._glowInner=t,this._comp&&this._comp.updateTmpMatGlow(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowOuter",{get:function(){return this._glowOuter},set:function(t){this._glowOuter!==t&&(this._glowOuter=t,this._comp&&this._comp.updateTmpMatGlow(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"glowPower",{get:function(){return this._glowPower},set:function(t){this._glowPower!==t&&(this._glowPower=t,this._comp&&this._comp.updateTmpMatGlow(this._comp.getMaterial(0)))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"comp",{get:function(){return this._comp},enumerable:!1,configurable:!0}),t.prototype.init=function(t){this._comp=t;var e=this._comp.getMaterial(0);this._comp.updateTmpMatFace(e),this._comp.updateTmpMatOutline(e),this._comp.updateTmpMatUnderlay(e),this._comp.updateTmpMatGlow(e)},r([_(cc.Color)],t.prototype,"_faceColor",void 0),r([_({tooltip:!1,type:cc.Color})],t.prototype,"faceColor",null),r([_()],t.prototype,"_faceDilate",void 0),r([_({tooltip:!1,range:[0,1,.01]})],t.prototype,"faceDilate",null),r([_()],t.prototype,"_faceSoftness",void 0),r([_({tooltip:!1,range:[0,1,.01]})],t.prototype,"faceSoftness",null),r([_()],t.prototype,"_enableOutline",void 0),r([_({tooltip:!1})],t.prototype,"enableOutline",null),r([_(cc.Color)],t.prototype,"_outlineColor",void 0),r([_({tooltip:!1,type:cc.Color,visible:function(){return this._enableOutline}})],t.prototype,"outlineColor",null),r([_()],t.prototype,"_outlineThickness",void 0),r([_({tooltip:!1,range:[0,1,.01],visible:function(){return this._enableOutline}})],t.prototype,"outlineThickness",null),r([_()],t.prototype,"_enableUnderlay",void 0),r([_({tooltip:!1})],t.prototype,"enableUnderlay",null),r([_(cc.Color)],t.prototype,"_underlayColor",void 0),r([_({tooltip:!1,type:cc.Color,visible:function(){return this._enableUnderlay}})],t.prototype,"underlayColor",null),r([_(cc.Vec2)],t.prototype,"_underlayOffset",void 0),r([_({tooltip:!1,type:cc.Vec2,range:[-1,1],visible:function(){return this._enableUnderlay}})],t.prototype,"underlayOffset",null),r([_()],t.prototype,"_underlayDilate",void 0),r([_({tooltip:!1,range:[0,1,.01],visible:function(){return this._enableUnderlay}})],t.prototype,"underlayDilate",null),r([_()],t.prototype,"_underlaySoftness",void 0),r([_({tooltip:!1,range:[0,1,.01],visible:function(){return this._enableUnderlay}})],t.prototype,"underlaySoftness",null),r([_()],t.prototype,"_enableGlow",void 0),r([_({tooltip:!1})],t.prototype,"enableGlow",null),r([_(cc.Color)],t.prototype,"_glowColor",void 0),r([_({tooltip:!1,type:cc.Color,visible:function(){return this._enableGlow}})],t.prototype,"glowColor",null),r([_()],t.prototype,"_glowOffset",void 0),r([_({tooltip:!1,range:[0,1,.01],visible:function(){return this._enableGlow}})],t.prototype,"glowOffset",null),r([_()],t.prototype,"_glowInner",void 0),r([_({tooltip:!1,range:[0,1,.01],visible:function(){return this._enableGlow}})],t.prototype,"glowInner",null),r([_()],t.prototype,"_glowOuter",void 0),r([_({tooltip:!1,range:[0,1,.01],visible:function(){return this._enableGlow}})],t.prototype,"glowOuter",null),r([_()],t.prototype,"_glowPower",void 0),r([_({tooltip:!1,range:[0,1,.01],visible:function(){return this._enableGlow}})],t.prototype,"glowPower",null),r([h("TmpUniform")],t)}();o.TmpUniform=f;var d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._string="",e._font=null,e._horizontalAlign=cc.Label.HorizontalAlign.LEFT,e._verticalAlign=cc.Label.VerticalAlign.TOP,e._actualFontSize=0,e._fontSize=32,e._lineHeight=32,e._spacingX=0,e._overflow=l.NONE,e._enableWrapText=!0,e._enableItalic=!1,e._enableUnderline=!1,e._underlineOffset=0,e._enableStrikethrough=!1,e._strikethroughOffset=0,e._colorGradient=!1,e._colorLB=cc.Color.WHITE,e._colorRB=cc.Color.WHITE,e._colorLT=cc.Color.WHITE,e._colorRT=cc.Color.WHITE,e.tmpUniform=new f,e.textures=[],e._fontConfig=null,e._assembler=null,e._worldVertsDirty=!1,e._colorExtraDirty=!1,e._richTextDeltaX=0,e}return n(e,t),Object.defineProperty(e.prototype,"string",{get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this.setVertsDirty(),this._checkStringEmpty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this.enabledInHierarchy&&this.forceUpdateRenderData())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlign",{get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlign",{get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"actualFontSize",{get:function(){return this._actualFontSize},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bmfontOriginalSize",{get:function(){return this.font?this.font.json.size:-1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"spacingX",{get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overflow",{get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enableWrapText",{get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enableItalic",{get:function(){return this._enableItalic},set:function(t){this._enableItalic!==t&&(this._enableItalic=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enableUnderline",{get:function(){return this._enableUnderline},set:function(t){this._enableUnderline!==t&&(this._enableUnderline=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"underlineOffset",{get:function(){return this._underlineOffset},set:function(t){this._underlineOffset!==t&&(this._underlineOffset=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"enableStrikethrough",{get:function(){return this._enableStrikethrough},set:function(t){this._enableStrikethrough!==t&&(this._enableStrikethrough=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"strikethroughOffset",{get:function(){return this._strikethroughOffset},set:function(t){this._strikethroughOffset!==t&&(this._strikethroughOffset=t,this.setVertsDirty())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorGradient",{get:function(){return this._colorGradient},set:function(t){this._colorGradient!==t&&(this._colorGradient=t,this._colorExtraDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorLB",{get:function(){return this._colorLB},set:function(t){this._colorLB!==t&&(this._colorLB=t,this._colorExtraDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorRB",{get:function(){return this._colorRB},set:function(t){this._colorRB!==t&&(this._colorRB=t,this._colorExtraDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorLT",{get:function(){return this._colorLT},set:function(t){this._colorLT!==t&&(this._colorLT=t,this._colorExtraDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"colorRT",{get:function(){return this._colorRT},set:function(t){this._colorRT!==t&&(this._colorRT=t,this._colorExtraDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontConfig",{get:function(){return this._fontConfig},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"richTextDeltaX",{get:function(){return this._richTextDeltaX},enumerable:!1,configurable:!0}),e.prototype.editorInit=function(){},e.prototype.resetInEditor=function(){},e.prototype.onLoad=function(){this.editorInit(),this.tmpUniform.init(this),!this._fontConfig&&this.font&&this.textures.length>0&&(this._fontConfig=new a.default(this._font.json,this.textures))},e.prototype.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.on(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this),this.forceUpdateRenderData()},e.prototype.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(cc.Node.EventType.SIZE_CHANGED,this._nodeSizeChanged,this),this.node.off(cc.Node.EventType.ANCHOR_CHANGED,this.setVertsDirty,this)},e.prototype.lateUpdate=function(){this._worldVertsDirty&&(this._worldVertsDirty=!1,this._assembler.updateWorldVerts(this)),this._colorExtraDirty&&(this._colorExtraDirty=!1,this._assembler.updateColorExtra(this))},e.prototype._nodeSizeChanged=function(){this.overflow!==l.NONE&&this.setVertsDirty()},e.prototype._validateRender=function(){this.string&&this.getMaterial(0)&&this.textures.length>0||this.disableRender()},e.prototype._resetAssembler=function(){cc.RenderComponent.prototype._resetAssembler.call(this)},e.prototype._checkStringEmpty=function(){this.markForRender(!!this.string)},e.prototype._on3DNodeChanged=function(){this._resetAssembler(),this._applyFontTexture()},e.prototype._onBMFontTextureLoaded=function(){this.markForRender(!0),this._updateMaterial()},e.prototype._onBlendChanged=function(){this.enabledInHierarchy&&this.forceUpdateRenderData()},e.prototype._applyFontTexture=function(){this.markForValidate()},e.prototype._updateMaterial=function(){var t=this.getMaterial(0);t&&(cc.BlendFunc.prototype._updateMaterialBlendFunc.call(this,t),this._updateTmpMatTexture(t),this.tmpUniform&&this.tmpUniform.comp&&(this.updateTmpMatFace(t),this.updateTmpMatOutline(t),this.updateTmpMatUnderlay(t),this.updateTmpMatGlow(t)))},e.prototype._updateTmpMatTexture=function(t){if(t&&!(this.textures.length<=0)){t.define("USE_TEXTURE_LEVEL_1",this.textures.length>0),t.define("USE_TEXTURE_LEVEL_2",this.textures.length>1),t.define("USE_TEXTURE_LEVEL_3",this.textures.length>2),t.define("USE_TEXTURE_LEVEL_4",this.textures.length>4);for(var e=0;e<this.textures.length;e++)t.setProperty("texture"+e,this.textures[e]);t._effect._dirty=!0}},e.prototype.updateTmpMatFace=function(t){t&&(t.setProperty("faceColor",this.tmpUniform.faceColor),t.setProperty("faceDilate",this.tmpUniform.faceDilate),t.setProperty("faceSoftness",this.tmpUniform.faceSoftness),t._effect._dirty=!0)},e.prototype.updateTmpMatOutline=function(t){t&&(t.define("USE_OUTLINE",this.tmpUniform.enableOutline),this.tmpUniform.enableOutline&&(t.setProperty("outlineColor",this.tmpUniform.outlineColor),t.setProperty("outlineThickness",this.tmpUniform.outlineThickness)),t._effect._dirty=!0)},e.prototype.updateTmpMatUnderlay=function(t){t&&(t.define("USE_UNDERLAY",this.tmpUniform.enableUnderlay),this.tmpUniform.enableUnderlay&&(t.setProperty("underlayColor",this.tmpUniform.underlayColor),t.setProperty("underlayOffsetX",this.tmpUniform.underlayOffset.x),t.setProperty("underlayOffsetY",this.tmpUniform.underlayOffset.y),t.setProperty("underlayDilate",this.tmpUniform.underlayDilate),t.setProperty("underlaySoftness",this.tmpUniform.underlaySoftness)),t._effect._dirty=!0)},e.prototype.updateTmpMatGlow=function(t){t&&(t.define("USE_GLOW",this.tmpUniform.enableGlow),this.tmpUniform.enableGlow&&(t.setProperty("glowColor",this.tmpUniform.glowColor),t.setProperty("glowOffset",this.tmpUniform.glowOffset),t.setProperty("glowInner",this.tmpUniform.glowInner),t.setProperty("glowOuter",this.tmpUniform.glowOuter),t.setProperty("glowPower",this.tmpUniform.glowPower)),t._effect._dirty=!0)},e.prototype.forceUpdateRenderData=function(){this.setVertsDirty(),this._resetAssembler(),this._applyFontTexture(),this._assembler&&this._assembler.updateRenderData(this),this.node._renderFlag|=cc.RenderFlow.FLAG_COLOR},e.prototype.setFont=function(t,e){!t||e.length<0?cc.error("please check your font!"):(this._font=t,this.textures=e,this._fontConfig=new a.default(this._font.json,this.textures),this.enabledInHierarchy&&(this.forceUpdateRenderData(),this._onBMFontTextureLoaded()))},e.prototype.isVisible=function(t){return!!this.enabledInHierarchy&&this._assembler.isVisble(t)},e.prototype.setVisible=function(t,e){this.enabledInHierarchy&&this._assembler.setVisible(this,t,e)},e.prototype.getColorExtraVertices=function(t){return this.enabledInHierarchy?this._assembler.getColorExtraVertices(t):null},e.prototype.setColorExtraVertices=function(t,e){this.enabledInHierarchy&&this._assembler.setColorExtraVertices(t,e)},e.prototype.getPosVertices=function(t){return this.enabledInHierarchy?this._assembler.getPosVertices(t):null},e.prototype.setPosVertices=function(t,e){this.enabledInHierarchy&&(this._assembler.setPosVertices(t,e),this._worldVertsDirty=!0)},r([_],e.prototype,"_string",void 0),r([_({multiline:!0})],e.prototype,"string",null),r([_(cc.JsonAsset)],e.prototype,"_font",void 0),r([_({tooltip:!1,type:cc.JsonAsset})],e.prototype,"font",null),r([_({type:cc.Label.HorizontalAlign})],e.prototype,"_horizontalAlign",void 0),r([_({type:cc.Label.HorizontalAlign})],e.prototype,"horizontalAlign",null),r([_({type:cc.Label.VerticalAlign})],e.prototype,"_verticalAlign",void 0),r([_({type:cc.Label.VerticalAlign})],e.prototype,"verticalAlign",null),r([_],e.prototype,"_actualFontSize",void 0),r([_({visible:function(){return this._overflow===l.SHRINK}})],e.prototype,"actualFontSize",null),r([_],e.prototype,"bmfontOriginalSize",null),r([_],e.prototype,"_fontSize",void 0),r([_({range:[0,1024]})],e.prototype,"fontSize",null),r([_],e.prototype,"_lineHeight",void 0),r([_],e.prototype,"lineHeight",null),r([_],e.prototype,"_spacingX",void 0),r([_],e.prototype,"spacingX",null),r([_({type:cc.Enum(l)})],e.prototype,"_overflow",void 0),r([_({tooltip:!1,type:cc.Enum(l)})],e.prototype,"overflow",null),r([_],e.prototype,"_enableWrapText",void 0),r([_({tooltip:!1,visible:function(){return this._overflow===l.CLAMP||this._overflow===l.ELLIPSIS}})],e.prototype,"enableWrapText",null),r([_],e.prototype,"_enableItalic",void 0),r([_({tooltip:!1})],e.prototype,"enableItalic",null),r([_],e.prototype,"_enableUnderline",void 0),r([_({tooltip:!1})],e.prototype,"enableUnderline",null),r([_],e.prototype,"_underlineOffset",void 0),r([_({tooltip:!1,visible:function(){return this._enableUnderline}})],e.prototype,"underlineOffset",null),r([_],e.prototype,"_enableStrikethrough",void 0),r([_({tooltip:!1})],e.prototype,"enableStrikethrough",null),r([_],e.prototype,"_strikethroughOffset",void 0),r([_({tooltip:!1,visible:function(){return this._enableStrikethrough}})],e.prototype,"strikethroughOffset",null),r([_],e.prototype,"_colorGradient",void 0),r([_({tooltip:!1})],e.prototype,"colorGradient",null),r([_(cc.Color)],e.prototype,"_colorLB",void 0),r([_({tooltip:!1,type:cc.Color,visible:function(){return this._colorGradient}})],e.prototype,"colorLB",null),r([_(cc.Color)],e.prototype,"_colorRB",void 0),r([_({tooltip:!1,type:cc.Color,visible:function(){return this._colorGradient}})],e.prototype,"colorRB",null),r([_(cc.Color)],e.prototype,"_colorLT",void 0),r([_({tooltip:!1,type:cc.Color,visible:function(){return this._colorGradient}})],e.prototype,"colorLT",null),r([_(cc.Color)],e.prototype,"_colorRT",void 0),r([_({tooltip:!1,type:cc.Color,visible:function(){return this._colorGradient}})],e.prototype,"colorRT",null),r([_({tooltip:!1,type:f})],e.prototype,"tmpUniform",void 0),r([_({tooltip:!1,type:cc.Texture2D,readonly:!0})],e.prototype,"textures",void 0),r([h,u,p("TextMeshPro\u7ec4\u4ef6/TextMeshPro")],e)}(cc.RenderComponent);o.default=d,cc.Assembler.register(d,{getConstructor:function(){return s.default}}),cc._RF.pop()},{"./utils/TmpAssembler":"TmpAssembler","./utils/TmpFontConfig":"TmpFontConfig","./utils/TmpUtils":"TmpUtils"}],TmpAssembler:[function(t,e,o){"use strict";cc._RF.push(e,"9193fC84H5POoNKD9ArVsQ0","TmpAssembler");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var r=t("../TextMeshPro"),l=cc.gfx,s=new l.VertexFormat([{name:l.ATTR_POSITION,type:l.ATTR_TYPE_FLOAT32,num:2},{name:l.ATTR_UV0,type:l.ATTR_TYPE_FLOAT32,num:2},{name:l.ATTR_COLOR,type:l.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:"a_color_extra",type:l.ATTR_TYPE_UINT8,num:4,normalize:!0},{name:"a_texture_idx",type:l.ATTR_TYPE_FLOAT32,num:1}]),a=cc.Color.WHITE,c=cc.misc.degreesToRadians(15),h={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",margin:0},_=null,u=cc.rect(),p=cc.rect(),f=[],d=[],g=[],y=null,m=0,v=0,b=0,C=0,S=0,x=1,E=cc.size(0,0),T="",B=0,w=0,O=0,I=0,P=0,A=0,D=0,k=!1,L=0,H=0,M=0,N=0,U=cc.v2(),R={},F=null,V=null,j=0,W=function(){this.valid=!0,this.char="",this.x=0,this.y=0,this.line=0,this.hash="",this.quadsIndex=0,this.visible=!0},G=function(t){function e(){var e=t.call(this)||this;return e.floatsPerVert=7,e.verticesCount=4,e.indicesCount=6,e.uvOffset=2,e.colorOffset=4,e.colorExtraOffset=5,e.textureIdxOffset=6,e._renderData=null,e._local=[],e._lettersInfo=[],e._renderData=new cc.RenderData,e._renderData.init(e),e.initData(),e.initLocal(),e}return n(e,t),Object.defineProperty(e.prototype,"verticesFloats",{get:function(){return this.verticesCount*this.floatsPerVert},enumerable:!1,configurable:!0}),e.prototype.initData=function(){var t=this._renderData;t.createFlexData(0,this.verticesCount,this.indicesCount,this.getVfmt());for(var e=t.iDatas[0],o=e.length/6,i=0,n=0;i<o;i++){var r=4*i;e[n++]=r,e[n++]=r+1,e[n++]=r+2,e[n++]=r+1,e[n++]=r+3,e[n++]=r+2}},e.prototype.initLocal=function(){this._local=[],this._local.length=4},e.prototype.getBuffer=function(){return cc.renderer._handle.getBuffer("mesh",this.getVfmt())},e.prototype.getVfmt=function(){return s},e.prototype.fillBuffers=function(t,e){e.worldMatDirty&&this.updateWorldVerts(t);var o=this._renderData,i=o.vDatas[0],n=o.iDatas[0],r=this.getBuffer(e),l=r.request(this.verticesCount,this.indicesCount),s=l.byteOffset>>2,a=r._vData;i.length+s>a.length?a.set(i.subarray(0,a.length-s),s):a.set(i,s);for(var c=r._iData,h=l.indiceOffset,_=l.vertexOffset,u=0,p=n.length;u<p;u++)c[h++]=_+n[u]},e.prototype.updateRenderData=function(t){t._vertsDirty&&_!==t&&t.fontConfig&&(_=t,this._lettersInfo.length=0,this._updateProperties(t),this._updateContent(),this.updateWorldVerts(t),_._actualFontSize=B,_.node.setContentSize(E),_._vertsDirty=!1,_=null,this._resetProperties())},e.prototype._updateProperties=function(t){y=t.fontConfig,T=t.string.toString(),B=t.fontSize,w=y?y.json.size:t.fontSize,x=B/w,O=t.horizontalAlign,I=t.verticalAlign,P=t.spacingX,D=t.overflow,A=t.lineHeight,E.width=t.node.width,E.height=t.node.height,h.fontAtlas=t.fontConfig,h.lineHeight=A,h.fontSize=B,h.hash="",h.margin=0,D===r.TmpOverflow.NONE?(k=!1,E.width+=2*h.margin,E.height+=2*h.margin):D===r.TmpOverflow.RESIZE_HEIGHT?(k=!0,E.height+=2*h.margin):k=D!==r.TmpOverflow.SHRINK&&t.enableWrapText,this._setupBMFontOverflowMetrics(),t.enableItalic&&(U.x=0,U.y=E.height/2,U.rotateSelf(c),E.width+=2*Math.abs(U.x),E.height-=2*Math.abs(E.height/2-U.y)),(t.enableUnderline||t.enableStrikethrough)&&((F=h.fontAtlas.getLetter(95+h.hash))||cc.log("Can't find letter definition in textures. letter: _")),t.overflow===r.TmpOverflow.ELLIPSIS&&((V=h.fontAtlas.getLetter(46+h.hash))?j=3*(V.xAdvance*x+P):(j=0,cc.log("Can't find letter definition in textures. letter: .")))},e.prototype._resetProperties=function(){y=null,h.hash="",h.margin=0},e.prototype._updateContent=function(){this._computeHorizontalKerningForText(),this._alignText()},e.prototype._computeHorizontalKerningForText=function(){T.length,f.length=0},e.prototype._alignText=function(){if(v=0,d.length=0,R={},this._multilineTextWrapByWord(),D===r.TmpOverflow.SHRINK&&B>0){var t=x,e=x,o=!1;v>E.height&&(t=E.height/v*x,o=!0);var i=0;d.forEach(function(t){t>i&&(i=t)}),i>E.width&&(e=E.width/i*x,o=!0),x=Math.min(t,e),o&&(B=x*w,v=0,d.length=0,R={},this._multilineTextWrapByWord())}this._computeAlignmentOffset(),this._reserveQuads(_,this._lettersInfo.length),this._updateQuads()},e.prototype._multilineTextWrapByWord=function(){return this._multilineTextWrap(this._getFirstWordLen)},e.prototype._multilineTextWrapByChar=function(){return this._multilineTextWrap(this._getFirstCharLen)},e.prototype._multilineTextWrap=function(t){var e=0,o=!1;D===r.TmpOverflow.ELLIPSIS&&V&&(e=Math.max(1,Math.floor(E.height/A)));for(var i=T.length,n=0,l=0,s=0,a=0,u=0,p=0,g=0,y=null,b=cc.v2(0,0),B=0;B<i;){var w=T.charAt(B);if("\n"!==w){for(var O=t(T,B,i),I=p,N=g,R=u,F=l,j=!1,W=0;W<O;++W){var G=B+W;if("\r"!==(w=T.charAt(G)))if(y=h.fontAtlas.getLetterDefinitionForChar(w)){var z=F+y.offsetX*x-h.margin;if(_.enableItalic&&(U.x=0,U.y=y.h*x/2,U.rotateSelf(c),z+=Math.abs(U.x)),D===r.TmpOverflow.ELLIPSIS&&V&&z+(y.xAdvance-y.offsetX)*x>M&&(!k||n+1>=e)){this._recordEllipsis(s,b,n),o=!0,u=this._lettersInfo[this._lettersInfo.length-1].x+(V.xAdvance-V.offsetX)*x+P-2*h.margin;break}if(k&&M>0&&l>0&&z+(y.xAdvance-y.offsetX)*x>M&&!cc.textUtils.isUnicodeSpace(w)){d.push(u),u=0,n++,l=0,s-=A*this._getFontScale()+0,j=!0;break}b.x=z,b.y=s-y.offsetY*x+h.margin,this._recordLetterInfo(b,w,G,n),G+1<f.length&&G<i-1&&(F+=f[G+1]),R=F+=y.xAdvance*x+P-2*h.margin,_.enableItalic&&(U.x=0,U.y=y.h*x/2,U.rotateSelf(c),R+=Math.abs(U.x)),I<b.y&&(I=b.y),N>b.y-y.h*x&&(N=b.y-y.h*x)}else this._recordPlaceholderInfo(G,w),cc.log("Can't find letter definition in textures. letter: "+w);else this._recordPlaceholderInfo(G,w)}if(o)break;j||(l=F,p<I&&(p=I),g>N&&(g=N),a<(u=R)&&(a=u),B+=O)}else{if(D===r.TmpOverflow.ELLIPSIS&&V&&n+1>=e){this._recordEllipsis(s,b,n),o=!0,u=this._lettersInfo[this._lettersInfo.length-1].x+(V.xAdvance-V.offsetX)*x+P-2*h.margin;break}d.push(u),u=0,n++,l=0,s-=A*this._getFontScale()+0,this._recordPlaceholderInfo(B,w),B++}}return d.push(u),v=(m=n+1)*A*this._getFontScale(),m>1&&(v+=0*(m-1)),E.width=L,E.height=H,L<=0&&(E.width=parseFloat(a.toFixed(2))+2*h.margin),H<=0&&(E.height=parseFloat(v.toFixed(2))+2*h.margin),C=E.height,S=0,D!==r.TmpOverflow.CLAMP&&(p>0&&(C=E.height+p),g<-v&&(S=v+g)),_._richTextDeltaX=l-u,!0},e.prototype._getFirstCharLen=function(){return 1},e.prototype._getFontScale=function(){return D===r.TmpOverflow.SHRINK?x:1},e.prototype._getFirstWordLen=function(t,e,o){var i=t.charAt(e);if(cc.textUtils.isUnicodeCJK(i)||"\n"===i||cc.textUtils.isUnicodeSpace(i))return 1;var n=1,r=h.fontAtlas.getLetterDefinitionForChar(i);if(!r)return n;for(var l=r.xAdvance*x+P,s=e+1;s<o&&(i=t.charAt(s),r=h.fontAtlas.getLetterDefinitionForChar(i));++s){if(l+r.offsetX*x+(r.xAdvance-r.offsetX)*x>M&&!cc.textUtils.isUnicodeSpace(i)&&M>0)return n;if(l+=r.xAdvance*x+P,"\n"===i||cc.textUtils.isUnicodeSpace(i)||cc.textUtils.isUnicodeCJK(i))break;n++}return n},e.prototype._recordEllipsis=function(t,e,o){for(var i=0,n=this._lettersInfo.length-1;n>=0;){var r=this._lettersInfo[n],l=h.fontAtlas.getLetterDefinitionForChar(r.char),s=l?l.w:0,a=l?l.xAdvance:0,c=l?l.offsetX:0,_=r.x+s*x-h.margin;if(i=r.x+(a-c)*x+P-2*h.margin,M>=_+j)break;n--,this._lettersInfo.pop()}n<0&&(i=0),e.y=t-V.offsetY*x+h.margin;for(var u=1;u<=3;u++)e.x=i+V.offsetX*x-h.margin,this._recordLetterInfo(e,".",n+u,o),i+=V.xAdvance*x+P-2*h.margin},e.prototype._recordPlaceholderInfo=function(t,e){if(t>=this._lettersInfo.length){var o=new W;this._lettersInfo.push(o)}this._lettersInfo[t].char=e,this._lettersInfo[t].hash=e.charCodeAt(0)+h.hash,this._lettersInfo[t].valid=!1},e.prototype._recordLetterInfo=function(t,e,o,i){if(o>=this._lettersInfo.length){var n=new W;this._lettersInfo.push(n)}var r=e.charCodeAt(0)+h.hash;this._lettersInfo[o].line=i,this._lettersInfo[o].char=e,this._lettersInfo[o].hash=r,this._lettersInfo[o].valid=h.fontAtlas.getLetter(r).valid,this._lettersInfo[o].x=t.x,this._lettersInfo[o].y=t.y},e.prototype._computeAlignmentOffset=function(){switch(g.length=0,O){case cc.Label.HorizontalAlign.LEFT:for(var t=0;t<m;++t)g.push(0);break;case cc.Label.HorizontalAlign.CENTER:t=0;for(var e=d.length;t<e;t++)g.push((E.width-d[t])/2);break;case cc.Label.HorizontalAlign.RIGHT:for(t=0,e=d.length;t<e;t++)g.push(E.width-d[t])}if(b=E.height,I!==cc.Label.VerticalAlign.TOP){var o=E.height-v+A*this._getFontScale()-w*x;I===cc.Label.VerticalAlign.BOTTOM?b-=o:b-=o/2}},e.prototype._setupBMFontOverflowMetrics=function(){var t=E.width,e=E.height;D===r.TmpOverflow.RESIZE_HEIGHT&&(e=0),D===r.TmpOverflow.NONE&&(t=0,e=0),L=t,H=e,M=t},e.prototype._updateQuads=function(){var t=_.node;this.verticesCount=this.indicesCount=0,this._renderData&&(this._renderData.dataLength=0);for(var e=E,o=t._anchorPoint.x*e.width,i=t._anchorPoint.y*e.height,n=0,l=0,s=this._lettersInfo.length;l<s;++l){var a=this._lettersInfo[l];if(!a)break;if(a.valid){a.quadsIndex=n;var c=h.fontAtlas.getLetter(a.hash);u.height=c.h,u.width=c.w,u.x=c.u,u.y=c.v;var f=a.y+b;if(H>0&&D===r.TmpOverflow.CLAMP){if(f>C){var d=f-C;u.y+=d/x,u.height-=d/x,f-=d}f-u.height*x<S&&(u.height=f<S?0:(f-S)/x)}var y=a.x+g[a.line];if(L>0&&D===r.TmpOverflow.CLAMP&&(y<0&&(u.x+=-y/x,u.width-=-y/x,y=0),y+u.width*x>E.width)){var m=y+u.width*x-E.width;u.width-=m/x}if(u.height>0&&u.width>0&&(p.x=y-o,p.y=f-i,p.width=u.width*x,p.height=u.height*x,this.appendQuad(c.textureId,u,p),n++,F&&(_.enableUnderline||_.enableStrikethrough)&&!cc.textUtils.isUnicodeSpace(a.char))){var v=R[a.line];v?v.last<l&&(v.last=l):R[a.line]={lineIndex:a.line,first:l,last:l}}}}F&&(_.enableUnderline&&this._updateLineQuads(o,i,-B+_.underlineOffset*x),_.enableStrikethrough&&this._updateLineQuads(o,i,-B/2+_.strikethroughOffset*x)),this.updateColorExtra(_),this._quadsUpdated()},e.prototype._updateLineQuads=function(t,e,o){for(var i in R){var n=R[i],l=n.lineIndex,s=n.first,a=n.last>0?n.last:s,c=this._lettersInfo[s];if(c.valid){var _=this._lettersInfo[a],f=h.fontAtlas.getLetter(c.hash),d=h.fontAtlas.getLetter(_.hash),y=_.x+d.w*x-c.x,m=y>=F.w*x?F.w*x/3:y/2,v=m,E=y-m-v,T=c.x+g[l],B=T+m+E,w=T+m;u.height=F.h,u.width=m/x,u.x=F.u,u.y=F.v;var O=c.y+b+f.offsetY*x+o;if(H>0){if(O>C){var I=O-C;u.y+=I,u.height-=I,O-=I}O-F.h*x<S&&D===r.TmpOverflow.CLAMP&&(u.height=O<S?0:(O-S)/x)}u.height>0&&u.width>0&&(p.x=T-t,p.y=O-e,p.width=m,p.height=u.height*x,this.appendQuad(F.textureId,u,p)),u.width=v/x,u.x=F.u+F.w-u.width,u.height>0&&u.width>0&&(p.x=B-t,p.y=O-e,p.width=v,p.height=u.height*x,this.appendQuad(F.textureId,u,p)),E>0&&(u.width=F.w-2*m/x,u.x=F.u+u.width,u.height>0&&u.width>0&&(p.x=w-t,p.y=O-e,p.width=E,p.height=u.height*x,this.appendQuad(F.textureId,u,p)))}}},e.prototype._reserveQuads=function(t,e){var o=0;t.enableUnderline&&o++,t.enableStrikethrough&&o++;var i=4*(e+=o*m*3),n=6*e,r=this._renderData._flexBuffer;r.reserve(i,n),r.used(i,n);for(var l=this._renderData.iDatas[0],s=0,a=0,c=n;s<c;s+=6,a+=4)l[s]=a,l[s+1]=a+1,l[s+2]=a+2,l[s+3]=a+1,l[s+4]=a+3,l[s+5]=a+2;N=0},e.prototype._quadsUpdated=function(){N=0,this._renderData._flexBuffer.used(this.verticesCount,this.indicesCount)},e.prototype.appendQuad=function(t,e,o){var i=this._renderData,n=i.vDatas[0],r=i.uintVDatas[0];this.verticesCount+=4,this.indicesCount=this.verticesCount/2*3;var l,s,c,u,p=h.fontAtlas.getTexture(t),f=p.width,d=p.height,g=e.width,y=e.height,m=_.node._color._val,v=this.floatsPerVert,b=N+this.uvOffset;l=e.x/f,c=(e.x+g)/f,s=(e.y+y)/d,u=e.y/d,n[b]=l,n[b+1]=s,n[b+=v]=c,n[b+1]=s,n[b+=v]=l,n[b+1]=u,n[b+=v]=c,n[b+1]=u,l=o.x,c=o.x+o.width,s=o.y-o.height,u=o.y,this.appendVerts(_,N,l,c,s,u);for(var C=N+this.colorOffset,S=0;S<4;S++)r[C]=m,C+=v;var x=N+this.colorExtraOffset;for(S=0;S<4;S++)r[x]=a._val,x+=v;var E=N+this.textureIdxOffset;for(S=0;S<4;S++)n[E]=t,E+=this.floatsPerVert;N+=4*this.floatsPerVert},e.prototype.appendVerts=function(t,e,o,i,n,r){var l=this._local,s=this.floatsPerVert;t.enableItalic?(U.x=0,U.y=(r-n)/2,U.rotateSelf(c),l[e]=o-Math.abs(U.x),l[e+1]=n+Math.abs((r-n)/2-U.y),l[e+=s]=i-Math.abs(U.x),l[e+1]=n+Math.abs((r-n)/2-U.y),l[e+=s]=o+Math.abs(U.x),l[e+1]=r-Math.abs((r-n)/2-U.y),l[e+=s]=i+Math.abs(U.x),l[e+1]=r-Math.abs((r-n)/2-U.y)):(l[e]=o,l[e+1]=n,l[e+=s]=i,l[e+1]=n,l[e+=s]=o,l[e+1]=r,l[e+=s]=i,l[e+1]=r)},e.prototype.updateWorldVerts=function(t){for(var e=t.node,o=this._local,i=this._renderData.vDatas[0],n=this.floatsPerVert,r=e._worldMatrix.m,l=r[0],s=r[1],a=r[4],c=r[5],h=r[12],_=r[13],u=0;u<o.length;u+=n){var p=o[u],f=o[u+1];i[u]=p*l+f*a+h,i[u+1]=p*s+f*c+_}},e.prototype.updateColor=function(t,e){var o=this._renderData.uintVDatas[0];if(o){e=null!=e?e:t.node.color._val;for(var i=this.floatsPerVert,n=this.colorOffset,r=o.length;n<r;n+=i)o[n]=e}},e.prototype.updateColorExtra=function(t){var e=this._renderData.uintVDatas[0];if(e)for(var o=cc.color(),i=0;i<this._lettersInfo.length;i++){var n=this._lettersInfo[i];if(n.valid&&!cc.textUtils.isUnicodeSpace(n.char)){var r=n.visible?1:0,l=this.colorExtraOffset+this.floatsPerVert*n.quadsIndex*4;o.set(a),o.setA(o.a*r),t.colorGradient&&o.multiply(t.colorLB),e[l]=o._val,l+=this.floatsPerVert,o.set(a),o.setA(o.a*r),t.colorGradient&&o.multiply(t.colorRB),e[l]=o._val,l+=this.floatsPerVert,o.set(a),o.setA(o.a*r),t.colorGradient&&o.multiply(t.colorLT),e[l]=o._val,l+=this.floatsPerVert,o.set(a),o.setA(o.a*r),t.colorGradient&&o.multiply(t.colorRT),e[l]=o._val}}},e.prototype.isVisble=function(t){var e=this._lettersInfo[t];return e&&e.valid&&e.visible&&!cc.textUtils.isUnicodeSpace(e.char)},e.prototype.setVisible=function(t,e,o){var i=this._lettersInfo[e];if(i&&this.isVisble(e)!==o&&i.visible!==o&&!cc.textUtils.isUnicodeSpace(i.char)){i.visible=o;var n=this.colorExtraOffset+this.floatsPerVert*i.quadsIndex*4,r=cc.color(),l=o?1:0,s=this._renderData.uintVDatas[0];r.set(a),r.setA(r.a*l),t.colorGradient&&r.multiply(t.colorLB),s[n]=r._val,n+=this.floatsPerVert,r.set(a),r.setA(r.a*l),t.colorGradient&&r.multiply(t.colorRB),s[n]=r._val,n+=this.floatsPerVert,r.set(a),r.setA(r.a*l),t.colorGradient&&r.multiply(t.colorLT),s[n]=r._val,n+=this.floatsPerVert,r.set(a),r.setA(r.a*l),t.colorGradient&&r.multiply(t.colorRT),s[n]=r._val}},e.prototype.getColorExtraVertices=function(t){var e=this._lettersInfo[t];if(!e||!e.valid)return null;for(var o=[],i=this._renderData.uintVDatas[0],n=this.colorExtraOffset+this.floatsPerVert*e.quadsIndex*4,r=0;r<4;r++){var l=cc.color();l._val=i[n],o.push(l),n+=this.floatsPerVert}return o},e.prototype.setColorExtraVertices=function(t,e){var o=this._lettersInfo[t];if(o&&o.valid&&4===e.length&&!cc.textUtils.isUnicodeSpace(o.char))for(var i=this._renderData.uintVDatas[0],n=this.colorExtraOffset+this.floatsPerVert*o.quadsIndex*4,r=0;r<4;r++)i[n]=e[r]._val,n+=this.floatsPerVert},e.prototype.getPosVertices=function(t){var e=this._lettersInfo[t];if(!e||!e.valid)return null;for(var o=[],i=this._local,n=this.floatsPerVert*e.quadsIndex*4,r=0;r<4;r++)o.push(cc.v2(i[n],i[n+1])),n+=this.floatsPerVert;return o},e.prototype.setPosVertices=function(t,e){var o=this._lettersInfo[t];if(o&&o.valid&&4===e.length&&!cc.textUtils.isUnicodeSpace(o.char))for(var i=this._local,n=this.floatsPerVert*o.quadsIndex*4,r=0;r<4;r++)i[n]=e[r].x,i[n+1]=e[r].y,n+=this.floatsPerVert},e}(cc.Assembler);o.default=G,cc._RF.pop()},{"../TextMeshPro":"TextMeshPro"}],TmpFontConfig:[function(t,e,o){"use strict";cc._RF.push(e,"60b25NdgrJE3pHzGZ1EQQrT","TmpFontConfig"),Object.defineProperty(o,"__esModule",{value:!0}),o.TmpFontLetter=void 0;var i=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureId=0,this.valid=!1,this.xAdvance=0};o.TmpFontLetter=i;var n=function(){function t(t,e){var o=this;this._letterDefinitions={},this._textures={},this._json=null,this._json=t,e.forEach(function(t,e){o._textures[e]=t}),t.charData.forEach(function(t){var e=new i;e.offsetX=t.xoffset,e.offsetY=t.yoffset,e.w=t.width,e.h=t.height,e.u=t.x,e.v=t.y,e.textureId=t.page,e.valid=!0,e.xAdvance=t.xadvance,o.addLetterDefinitions(t.id,e)})}return Object.defineProperty(t.prototype,"json",{get:function(){return this._json},enumerable:!1,configurable:!0}),t.prototype.addTexture=function(t,e){this._textures[t]=e},t.prototype.addLetterDefinitions=function(t,e){this._letterDefinitions[t]=e},t.prototype.cloneLetterDefinition=function(){var t={};for(var e in this._letterDefinitions){var o=new i;cc.js.mixin(o,this._letterDefinitions[e]),t[e]=o}return t},t.prototype.getTexture=function(t){return this._textures[t]},t.prototype.getLetter=function(t){return this._letterDefinitions[t]},t.prototype.getLetterDefinitionForChar=function(t){var e=t.charCodeAt(0);return this._letterDefinitions.hasOwnProperty(e)?this._letterDefinitions[e]:null},t.prototype.clear=function(){this._letterDefinitions={}},t}();o.default=n,cc._RF.pop()},{}],TmpRichText:[function(t,e,o){"use strict";cc._RF.push(e,"c4f1avKus9MM6INFfM10YV9","TmpRichText");var i,n=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),r=this&&this.__decorate||function(t,e,o,i){var n,r=arguments.length,l=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,o,i);else for(var s=t.length-1;s>=0;s--)(n=t[s])&&(l=(r<3?n(l):r>3?n(e,o,l):n(e,o))||l);return r>3&&l&&Object.defineProperty(e,o,l),l};Object.defineProperty(o,"__esModule",{value:!0});var l=t("./TextMeshPro"),s=t("./utils/HtmlParser"),a=(t("./utils/TmpUtils"),cc._decorator),c=a.ccclass,h=a.property,_=a.disallowMultiple,u=a.executeInEditMode,p=a.menu,f=new s.HtmlTextParser,d=new cc.js.Pool(function(t){return!!cc.isValid(t)},20);d.get=function(){var t=this._get();t||((t=new cc.PrivateNode("RICHTEXT_CHILD"))._objFlags|=cc.Object.Flags.DontSave),t.setPosition(0,0),t.setAnchorPoint(.5,.5);var e=t.getComponent(l.default);return e||(e=t.addComponent(l.default)),e.string="",e.horizontalAlign=cc.Label.HorizontalAlign.LEFT,e.verticalAlign=cc.Label.VerticalAlign.CENTER,t};var g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._string="",e._font=null,e._horizontalAlign=cc.Label.HorizontalAlign.LEFT,e._verticalAlign=cc.Label.VerticalAlign.TOP,e._fontSize=32,e._maxWidth=0,e._lineHeight=32,e._imageAtlas=null,e._handleTouchEvent=!0,e.material=null,e.textures=[],e._textArray=null,e._labelSegments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineOffsetX=0,e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._labelContent=null,e._imageContent=null,e}return n(e,t),Object.defineProperty(e.prototype,"string",{get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichText())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"font",{get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._updateRichText())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"horizontalAlign",{get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichText())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticalAlign",{get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._layoutDirty=!0,this._updateRichText())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichText())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichText())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichText())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"imageAtlas",{get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichText())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"handleTouchEvent",{get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"labelContent",{get:function(){var t;return this._labelContent||(this._labelContent=null!==(t=this.node.getChildByName("TMP_LABEL_CONTENT"))&&void 0!==t?t:new cc.PrivateNode("TMP_LABEL_CONTENT"),this._labelContent._objFlags|=cc.Object.Flags.DontSave,this.node.insertChild(this._labelContent,this._imageContent?1:0)),this._labelContent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"imageContent",{get:function(){var t;return this._imageContent||(this._imageContent=null!==(t=this.node.getChildByName("TMP_IMAGE_CONTENT"))&&void 0!==t?t:new cc.PrivateNode("TMP_IMAGE_CONTENT"),this._imageContent._objFlags|=cc.Object.Flags.DontSave,this.node.insertChild(this._imageContent,0)),this._imageContent},enumerable:!1,configurable:!0}),e.prototype.editorInit=function(){},e.prototype.resetInEditor=function(){},e.prototype.onRestore=function(){},e.prototype.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._onFontLoaded(),this._activateChildren(!0)},e.prototype.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},e.prototype.onDestroy=function(){for(var t=0;t<this._labelSegments.length;++t)this._labelSegments[t].removeFromParent(),d.put(this._labelSegments[t])},e.prototype._onColorChanged=function(t){this.node.children.forEach(function(e){e.children.forEach(function(e){e.color=t})})},e.prototype._addEventListeners=function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this)},e.prototype._removeEventListeners=function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.COLOR_CHANGED,this._onColorChanged,this)},e.prototype._updateLabelSegmentTextAttributes=function(){this._labelSegments.forEach(function(t){this._applyTextAttribute(t,null,!0)}.bind(this))},e.prototype._createFontLabel=function(t){var e=d.get(t,this),o=e.getComponent(l.default);return o&&o.getMaterial(0)!==this.material&&o.setMaterial(0,this.material),e},e.prototype._onFontLoaded=function(){this._layoutDirty=!0,this._updateRichText()},e.prototype._measureText=function(t,e){var o=this,i=function(e){var i;return 0===o._labelSegmentsCache.length?(i=o._createFontLabel(e),o._labelSegmentsCache.push(i)):i=o._labelSegmentsCache[0],i._styleIndex=t,o._applyTextAttribute(i,e,!0),i.getContentSize().width};return e?i(e):i},e.prototype._onTouchEnded=function(t){for(var e=this.node.getComponents(cc.Component),o=function(o){var n=i._labelSegments[o],r=n._clickHandler,l=n._clickParam;r&&i._containsTouchLocation(n,t.touch.getLocation())&&(e.forEach(function(e){e.enabledInHierarchy&&e[r]&&e[r](t,l)}),t.stopPropagation())},i=this,n=0;n<this._labelSegments.length;++n)o(n)},e.prototype._containsTouchLocation=function(t,e){return t.getBoundingBoxToWorld().contains(e)},e.prototype._resetContent=function(t){if(t)for(var e=t.children,o=e.length-1;o>=0;o--){var i=e[o];"RICHTEXT_CHILD"!==i.name&&"RICHTEXT_Image_CHILD"!==i.name||(i.parent===t?i.parent=null:e.splice(o,1),"RICHTEXT_CHILD"===i.name&&d.put(i))}},e.prototype._resetState=function(){for(var t=0;t<this.node.childrenCount;t++)this._resetContent(this.node.children[t]);this._labelSegments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},e.prototype._activateChildren=function(t){this.node.children.forEach(function(e){for(var o=e.children.length-1;o>=0;o--){var i=e.children[o];"RICHTEXT_CHILD"!==i.name&&"RICHTEXT_Image_CHILD"!==i.name||(i.active=t)}})},e.prototype._addLabelSegment=function(t,e){var o,i=(o=0===this._labelSegmentsCache.length?this._createFontLabel(t):this._labelSegmentsCache.pop()).getComponent(l.default);return i.verticalAlign!==this._verticalAlign&&(i.verticalAlign=this._verticalAlign),o._styleIndex=e,o._lineCount=this._lineCount,o.active=this.node.active,o.setAnchorPoint(0,0),this._applyTextAttribute(o,t,!1),this.labelContent.addChild(o),this._labelSegments.push(o),o},e.prototype._updateRichTextWithMaxWidth=function(t,e,o){var i=e;if(this._lineOffsetX>0&&i+this._lineOffsetX>this.maxWidth)for(var n=0;this._lineOffsetX<=this.maxWidth;){var r=this._getFirstWordLen(t,n,t.length),l=t.substr(n,r),s=this._measureText(o,l);if(!(this._lineOffsetX+s<=this.maxWidth)){if(n>0){var a=t.substr(0,n);this._addLabelSegment(a,o),t=t.substr(n,t.length),i=this._measureText(o,t)}this._updateLineInfo();break}this._lineOffsetX+=s,n+=r}if(i>this.maxWidth)for(var c=cc.textUtils.fragmentText(t,i,this.maxWidth,this._measureText(o)),h=0;h<c.length;++h){var _=c[h],u=this._addLabelSegment(_,o).getContentSize();this._lineOffsetX+=u.width,c.length>1&&h<c.length-1&&this._updateLineInfo()}else this._lineOffsetX+=i,this._addLabelSegment(t,o)},e.prototype._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},e.prototype._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},e.prototype._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;++e){var o=this._textArray[e],i=t[e];if(o.text!==i.text)return!0;var n=o.style,r=i.style;if(n){if(r){if(!n.outline!=!r.outline)return!0;if(n.size!==r.size||!n.italic!=!r.italic||n.isImage!==r.isImage)return!0;if(n.src!==r.src||n.imageAlign!==r.imageAlign||n.imageHeight!==r.imageHeight||n.imageWidth!==r.imageWidth||n.imageOffset!==r.imageOffset)return!0}else if(n.size||n.italic||n.isImage||n.outline)return!0}else if(r&&(r.size||r.italic||r.isImage||r.outline))return!0}return!1},e.prototype._addRichTextImageElement=function(t){var e=t.style.src,o=this.imageAtlas.getSpriteFrame(e);if(o){var i=new cc.PrivateNode("RICHTEXT_Image_CHILD");i._objFlags|=cc.Object.Flags.DontSave;var n=i.addComponent(cc.Sprite);switch(t.style.imageAlign){case"top":i.setAnchorPoint(0,1);break;case"center":i.setAnchorPoint(0,.5);break;default:i.setAnchorPoint(0,0)}t.style.imageOffset&&(i._imageOffset=t.style.imageOffset),n.type=cc.Sprite.Type.SLICED,n.sizeMode=cc.Sprite.SizeMode.CUSTOM,this.imageContent.addChild(i),this._labelSegments.push(i);var r=o.getRect(),l=1,s=r.width,a=r.height,c=t.style.imageWidth,h=t.style.imageHeight;h>0?(s*=l=h/a,a*=l):(s*=l=this.lineHeight/a,a*=l),c>0&&(s=c),this.maxWidth>0?(this._lineOffsetX+s>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=s):(this._lineOffsetX+=s,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),n.spriteFrame=o,i.setContentSize(s,a),i._lineCount=this._lineCount,t.style.event?(t.style.event.click&&(i._clickHandler=t.style.event.click),t.style.event.param?i._clickParam=t.style.event.param:i._clickParam=""):i._clickHandler=null}else cc.warnID(4400)},e.prototype._updateRichText=function(){if(this.enabledInHierarchy){var t=f.parse(this.string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,o=!1,i=0;i<this._textArray.length;++i){var n=this._textArray[i],r=n.text;if(""===r){if(n.style&&n.style.newline){this._updateLineInfo();continue}if(n.style&&n.style.isImage&&this.imageAtlas){this._addRichTextImageElement(n);continue}}for(var l=r.split("\n"),s=0;s<l.length;++s){var a=l[s];if(""!==a)if(o=!1,this.maxWidth>0){var c=this._measureText(i,a);this._updateRichTextWithMaxWidth(a,c,i),l.length>1&&s<l.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(a,i).getContentSize(),this._lineOffsetX+=e.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),l.length>1&&s<l.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(r)&&s===l.length-1)continue;this._updateLineInfo(),o=!0}}}o||this._linesWidth.push(this._lineOffsetX),this.maxWidth>0&&(this._labelWidth=this.maxWidth),this._labelHeight=(this._lineCount+cc.textUtils.BASELINE_RATIO)*this.lineHeight,this.node.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},e.prototype._getFirstWordLen=function(t,e,o){var i=t.charAt(e);if(cc.textUtils.isUnicodeCJK(i)||cc.textUtils.isUnicodeSpace(i))return 1;for(var n=1,r=e+1;r<o&&(i=t.charAt(r),!cc.textUtils.isUnicodeSpace(i)&&!cc.textUtils.isUnicodeCJK(i));++r)n++;return n},e.prototype._updateRichTextPosition=function(){for(var t=0,e=1,o=this._lineCount,i=0;i<this._labelSegments.length;++i){var n=this._labelSegments[i],r=n._lineCount;r>e&&(t=0,e=r);var s=0;switch(this.horizontalAlign){case cc.Label.HorizontalAlign.LEFT:s=-this._labelWidth/2;break;case cc.Label.HorizontalAlign.CENTER:s=-this._linesWidth[r-1]/2;break;case cc.Label.HorizontalAlign.RIGHT:s=this._labelWidth/2-this._linesWidth[r-1]}if(n.x=t+s,n.y=this.lineHeight*(o-r)-this._labelHeight/2,r===e){t+=n.getContentSize().width;var a=n.getComponent(l.default);a&&a.richTextDeltaX&&(t+=a.richTextDeltaX)}if(n.getComponent(cc.Sprite)){var c=this.lineHeight,h=this.lineHeight*(1+cc.textUtils.BASELINE_RATIO);switch(n.anchorY){case 1:n.y+=c+(h-c)/2;break;case.5:n.y+=h/2;break;default:n.y+=(h-c)/2}if(n._imageOffset){var _=n._imageOffset.split(",");if(1===_.length&&_[0]){var u=parseFloat(_[0]);Number.isInteger(u)&&(n.y+=u)}else if(2===_.length){var p=parseFloat(_[0]);u=parseFloat(_[1]),Number.isInteger(p)&&(n.x+=p),Number.isInteger(u)&&(n.y+=u)}}}}},e.prototype._convertLiteralColorValue=function(t){var e=t.toUpperCase();if(cc.Color[e])return cc.Color[e];var o=0===t.indexOf("#")?t.substring(1):t,i=parseInt(o.substring(0,2),16)||0,n=parseInt(o.substring(2,4),16)||0,r=parseInt(o.substring(4,6),16)||0,l=parseInt(o.substring(6,8),16);return Number.isNaN(l)&&(l=255),cc.color(i,n,r,l)},e.prototype._applyTextAttribute=function(t,e,o){var i=t.getComponent(l.default);if(i){var n=t._styleIndex,r=null;this._textArray[n]&&(r=this._textArray[n].style),r&&r.color?t.color=this._convertLiteralColorValue(r.color):t.color=this.node.color,i.setFont(this.font,this.textures),i.lineHeight=this.lineHeight,i.colorGradient=Boolean(r&&r.colorGradient),i.colorGradient&&(i.colorLB=this._convertLiteralColorValue(r.colorGradient.lb),i.colorRB=this._convertLiteralColorValue(r.colorGradient.rb),i.colorLT=this._convertLiteralColorValue(r.colorGradient.lt),i.colorRT=this._convertLiteralColorValue(r.colorGradient.rt)),r&&r.face?(i.tmpUniform.faceColor=this._convertLiteralColorValue(r.face.color),i.tmpUniform.faceDilate=r.face.dilate,i.tmpUniform.faceSoftness=r.face.softness):(i.tmpUniform.faceColor=cc.Color.WHITE,i.tmpUniform.faceDilate=.5,i.tmpUniform.faceSoftness=.01),i.enableItalic=Boolean(r&&r.italic),i.enableUnderline=Boolean(r&&r.underline),i.enableUnderline&&(i.underlineOffset=r.offset||0),i.enableStrikethrough=Boolean(r&&r.strikethrough),i.enableStrikethrough&&(i.strikethroughOffset=r.offset||0),i.tmpUniform.enableOutline=Boolean(r&&r.outline),r&&r.outline&&(i.tmpUniform.outlineColor=this._convertLiteralColorValue(r.outline.color),i.tmpUniform.outlineThickness=r.outline.thickness),i.tmpUniform.enableUnderlay=Boolean(r&&r.underlay),i.tmpUniform.enableUnderlay&&(i.tmpUniform.underlayColor=this._convertLiteralColorValue(r.underlay.color),i.tmpUniform.underlayOffset=cc.v2(r.underlay.x,r.underlay.y),i.tmpUniform.underlayDilate=r.underlay.dilate,i.tmpUniform.underlaySoftness=r.underlay.softness),i.tmpUniform.enableGlow=Boolean(r&&r.glow),i.tmpUniform.enableGlow&&(i.tmpUniform.glowColor=this._convertLiteralColorValue(r.glow.color),i.tmpUniform.glowOffset=r.glow.offset,i.tmpUniform.glowInner=r.glow.inner,i.tmpUniform.glowOuter=r.glow.outer,i.tmpUniform.glowPower=r.glow.power),r&&r.size?i.fontSize=r.size:i.fontSize=this.fontSize,null!==e&&("string"!=typeof e&&(e=""+e),i.string=e),o&&i.forceUpdateRenderData(),r&&r.event?(r.event.click&&(t._clickHandler=r.event.click),r.event.param?t._clickParam=r.event.param:t._clickParam=""):t._clickHandler=null}},r([h],e.prototype,"_string",void 0),r([h({multiline:!0})],e.prototype,"string",null),r([h(cc.JsonAsset)],e.prototype,"_font",void 0),r([h({tooltip:!1,type:cc.JsonAsset})],e.prototype,"font",null),r([h({type:cc.Label.HorizontalAlign})],e.prototype,"_horizontalAlign",void 0),r([h({type:cc.Label.HorizontalAlign})],e.prototype,"horizontalAlign",null),r([h({type:cc.Label.VerticalAlign})],e.prototype,"_verticalAlign",void 0),r([h({type:cc.Label.VerticalAlign})],e.prototype,"verticalAlign",null),r([h],e.prototype,"_fontSize",void 0),r([h({range:[0,1024]})],e.prototype,"fontSize",null),r([h],e.prototype,"_maxWidth",void 0),r([h({tooltip:!1})],e.prototype,"maxWidth",null),r([h],e.prototype,"_lineHeight",void 0),r([h],e.prototype,"lineHeight",null),r([h(cc.SpriteAtlas)],e.prototype,"_imageAtlas",void 0),r([h(cc.SpriteAtlas)],e.prototype,"imageAtlas",null),r([h],e.prototype,"_handleTouchEvent",void 0),r([h],e.prototype,"handleTouchEvent",null),r([h(cc.Material)],e.prototype,"material",void 0),r([h({tooltip:!1,type:cc.Texture2D,readonly:!0})],e.prototype,"textures",void 0),r([c,_,u,p("TextMeshPro\u7ec4\u4ef6/TmpRichText")],e)}(cc.Component);o.default=g,cc._RF.pop()},{"./TextMeshPro":"TextMeshPro","./utils/HtmlParser":"HtmlParser","./utils/TmpUtils":"TmpUtils"}],TmpUtils:[function(t,e,o){"use strict";cc._RF.push(e,"afca7qBhjVE+Kv0IUWRakh1","TmpUtils"),Object.defineProperty(o,"__esModule",{value:!0});var i=function(){function t(){}return t.load=function(){return new Promise(function(t){t(null)})},t.waitCmpt=function(t,e){return new Promise(function(o){t.scheduleOnce(function(){o()},e)})},t.TMP_MAT="textMeshPro/resources/shader/materials/textMeshPro.mtl",t}();o.default=i,cc._RF.pop()},{}],Trail_Point:[function(t,e){"use strict";cc._RF.push(e,"85666zKMnxCeYQD6R+Mjd5O","Trail_Point"),cc.Class({extends:cc.Component,onCollisionEnter:function(t){"Ground"===t.node.group&&this.node.destroy()},onCollisionStay:function(t){"Ground"===t.node.group&&this.node.destroy()}}),cc._RF.pop()},{}],Trajectory_Controller:[function(t,e){"use strict";cc._RF.push(e,"7d2db15IiFHjIlh9UiT8+vy","Trajectory_Controller"),cc.Class({extends:cc.Component,properties:{Bullet_Trail:cc.Prefab,Bullet_Trail_Parent:cc.Node},onLoad:function(){this._trailPoints=[],this._physicsManager=cc.director.getPhysicsManager()},clearTrajectory:function(){this._trailPoints=this._trailPoints.filter(function(t){return!(!t||!t.isValid||(t.destroy(),1))})},cleanDestroyedPoints:function(){this._trailPoints=this._trailPoints.filter(function(t){return t&&t.isValid})},updateTrajectory:function(t,e,o,i,n){this.clearTrajectory();var r=this._physicsManager.gravity.y;o=o*Math.PI/180;for(var l=Math.cos(o)*i,s=Math.sin(o)*i,a=0;a<20;a++){var c=.1*a,h=t+l*c,_=e+s*c+.5*r*n*c*c;this.createTrailPoint(h,_)}},createTrailPoint:function(t,e){var o=cc.instantiate(this.Bullet_Trail);o.parent=this.Bullet_Trail_Parent,o.x=t,o.y=e,this._trailPoints.push(o)},update:function(){this.cleanDestroyedPoints()}}),cc._RF.pop()},{}],Two_Select_One_Button:[function(t,e){"use strict";cc._RF.push(e,"8d89eMP+2pACYrcgwqj9kch","Two_Select_One_Button"),cc.Class({extends:cc.Component,properties:{Battle_Controller:null,Index:0,Event_ID:0,Content_Label:cc.Label,Element_Label:cc.Label,ParamA:0,ParamB:0},start:function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onButtonClick,this)},onButtonClick:function(){if(this.Battle_Controller){var t="Event_Effect_"+this.Event_ID+"_"+this.Index;"function"==typeof this[t]?(console.log("\u6267\u884c\u4e8b\u4ef6\u6548\u679c: "+t+", \u53c2\u6570A: "+this.ParamA+", \u53c2\u6570B: "+this.ParamB),this[t](this.ParamA,this.ParamB)):console.warn("\u4e8b\u4ef6\u6548\u679c\u65b9\u6cd5 "+t+" \u4e0d\u5b58\u5728")}},Event_Effect_9_1:function(t){this.Battle_Controller.Add_Hp(t),this.Battle_Controller.No_Event_Create_Event_Show(1,"\u7ecf\u8fc7\u4f11\u606f\uff0c\u6218\u58eb\u4eec\u90fd\u53d8\u5f97\u7cbe\u529b\u5145\u6c9b",!0,"\u751f\u547d\u503c+"+t+"%"),this.Battle_Controller.Next_Day_Button.active=!0,this.Battle_Controller.Two_Select_One_Button[0].node.active=!1,this.Battle_Controller.Two_Select_One_Button[1].node.active=!1},Event_Effect_9_2:function(t){var e=Math.ceil(this.Battle_Controller.Hero_Attack*(t/100));this.Battle_Controller.Add_Attack(e),this.Battle_Controller.No_Event_Create_Event_Show(1,"\u7ecf\u8fc7\u8bad\u7ec3\uff0c\u6218\u58eb\u4eec\u90fd\u5f97\u66f4\u5f3a\u4e86",!0,"\u653b\u51fb\u529b+"+t+"%"),this.Battle_Controller.Next_Day_Button.active=!0,this.Battle_Controller.Two_Select_One_Button[0].node.active=!1,this.Battle_Controller.Two_Select_One_Button[1].node.active=!1}}),cc._RF.pop()},{}]},{},["Battle_Controller","Bullet_Mult","Enemy","Event","Hero_Bullet","Hero_Bullet_Bomb","Hti_Number","Level_Up_Select_Button","Motion_Streak_Script","Skill_Cool_Icon","Trail_Point","Trajectory_Controller","Two_Select_One_Button","Example1","TextMeshPro","TmpRichText","HtmlParser","TmpAssembler","TmpFontConfig","TmpUtils"]);